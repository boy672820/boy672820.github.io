---
layout: post
title: SSE(Server-Sent Events)
categories: [BE, FE]
tags: [webapis, nestjs, reactnative]
description: SSEë¥¼ ì´ìš©í•œ ì„œë²„ì—ì„œ ë°ì´í„° ìˆ˜ì‹ 
---

# SSE(Server-Sent Events)

ì¼ë°˜ì ìœ¼ë¡œ ì›¹ í˜ì´ì§€ì—ì„œ ì„œë²„ì— ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” ì „í†µì ì¸ ë°©ì‹ì˜ HTTP í”„ë¡œí† ì½œì´ì§€ë§Œ, ì„œë²„ê°€ ì›¹ í˜ì´ì§€ì— ë©”ì‹œì§€ë¥¼ í‘¸ì‹œí•  ìˆ˜ ìˆë‹¤. ì¦‰, ì„œë²„ì—ì„œ ì‚¬ìš©ìì—ê²Œ ë°ì´í„°ë¥¼ ë³´ë‚´ëŠ” ë°©ì‹ì´ ê°€ëŠ¥í•˜ë‹¤. ìˆ˜ì‹ ëœ ë©”ì‹œì§€ëŠ” ì´ë²¤íŠ¸+ë°ì´í„°ë¡œ ì²˜ë¦¬ë  ìˆ˜ ìˆë‹¤.

SSEëŠ” ì›¹ ì†Œì¼“ê³¼ ê±°ì˜ ë™ì¼í•˜ê²Œ ì‘ë™í•˜ë©°, ì†Œì¼“ê³¼ ë‹¬ë¦¬ ë‹¨ë°©í–¥ í†µì‹ ë§Œ ê°€ëŠ¥í•˜ë‹¤.

```jsx
const evtSource = new EventSource("ssedemo.php");

evtSource.onmessage = function(event) {
  const newElement = document.createElement("li");
  const eventList = document.getElementById("list");

  newElement.textContent = "message: " + event.data;
  eventList.appendChild(newElement);
}
```

React Native ëª¨ë°”ì¼ í”Œë«í¼ì—ì„œëŠ” í´ë¦¬í•„ë¡œ êµ¬í˜„ëœ EventSource ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤.

[GitHub - boy672820/reactnative-sse: React native SSE í…ŒìŠ¤íŠ¸, react-native-sse ì‚¬ìš©](https://github.com/boy672820/reactnative-sse)

React Nativeì—ì„œ EventSource ì‚¬ìš©

MDN ì°¸ì¡°: [https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events)

### Nest.jsì—ì„œ ì œê³µí•˜ëŠ” SSE

```tsx
// controller
@Sse('sse')
sse(): Promise<Observable<unknown>> {
  const receive = await this.userService.subscribeCreatedUser();

  return receive;
}
```

nest.jsì—ì„œ í•¸ë“¤ëŸ¬ì— `@Sse()` ë°ì½”ë ˆì´í„°ë¥¼ ì¶”ê°€í•˜ë©´ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

ë˜í•œ ì´ë²¤íŠ¸ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°ì´í„° ë³€ê²½ì— ë”°ë¥¸ ê°ì‹œë¥¼ í•  ìˆ˜ ìˆë‹¤. `eventEmitter` ë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

```tsx
// provider
import EventEmitter from 'events';

export const userProviders = [
  {
    provide: 'EVENT_EMITTER',
    useValue: new EventEmitter(),
  },
];
```

```tsx
// service
import { fromEvent, Observable } from 'rxjs';

...

subscribeCreatedUser(): Observable<unknown> {
  return fromEvent(this.eventEmitter, 'USER.CREATED');
}
```

<aside>
ğŸ’¡ ì„œë²„ì—ì„œ **HTTP/1.1ì„ ì‚¬ìš©í•  ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì™€ì˜ ì—°ê²°ì´ ìµœëŒ€ 6ê°œë¡œ ì œí•œ**ë˜ì–´ ìˆë‹¤. HTTP/2ì˜ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì™€ì˜ ì—°ê²°ì„ ìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.(ê¸°ë³¸ê°’ 100)

</aside>
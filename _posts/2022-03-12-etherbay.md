# íƒˆì¤‘ì•™í™” eBay ë§Œë“¤ê¸°, ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸

ì´ë”ë¦¬ì›€ ê¸°ë°˜ì˜ íƒˆì¤‘ì•™í™” eBay ê°œë°œ

ê¸°ì¡´ ì´ë² ì´ëŠ” ê±°ë˜ê°€ ì„±ì‚¬ë˜ë©´ ebay íšŒì‚¬ê°€ íŒë§¤ìì—ê²Œ ì•Œë¦¬ê³  ê±°ë˜ë‚´ì—­ì„ ì§ì ‘ ì €ì¥í•˜ëŠ” ë°©ì‹ì´ì—ˆì§€ë§Œ, ì´ë¥¼ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¡œ êµ¬í˜„í•˜ì—¬ íƒˆì¤‘ì•™í™”ëœ eBayë¥¼ ë§Œë“¤ì–´ë³´ì.

[GitHub - boy672820/etherbay-contract: íƒˆì¤‘ì•™í™” eBay ì»¨íŠ¸ë™íŠ¸](https://github.com/boy672820/etherbay-contract)

# íƒˆì¤‘ì•™í™”(Decentralized)

---

íƒˆì¤‘ì•™í™”ë€, ì¤‘ì•™ì§‘ì¤‘í™”ë¥¼ ë²—ì–´ë‚˜ ë¶„ì‚°ëœ ì†Œê·œëª¨ ë‹¨ìœ„ë¡œ ììœ¨ì ìœ¼ë¡œ ìš´ì˜ë˜ëŠ” ê²ƒì„ ë§í•œë‹¤.

![ì¤‘ì•™í™”(Centralized), íƒˆì¤‘ì•™í™”(Decentraized), ë¶„ì‚°í™”(Distributed)](2022-03-12-etherbay/Untitled.png)

ì¤‘ì•™í™”(Centralized), íƒˆì¤‘ì•™í™”(Decentraized), ë¶„ì‚°í™”(Distributed)

[ì¤‘ì•™í™” vs íƒˆì¤‘ì•™í™”](https://www.notion.so/4cfb9550f5e24b2fa9394a3c0f6e8b85)

<aside>
ğŸ’¡ **ë¶„ì‚°í™”(Distributed networks)**ë€ ê°œë…ë„ ìˆëŠ”ë°, ì´ëŠ” ëª…í™•íˆ **íƒˆì¤‘ì•™í™”ì™€ ë‹¤ë¥¸ ì˜ë¯¸**ì´ë‹¤.
íƒˆì¤‘ì•™í™”ëŠ” ê´€ë¦¬ ì£¼ì²´ê°€ íŠ¹ì •í•˜ì§€ ì•Šì§€ë§Œ, ë¶„ì‚°í™”ëŠ” ì¤‘ì•™í™”ëœ ì£¼ì²´ë“¤ì´ ë¶„ì‚°ë˜ì–´ ìš´ì˜í•˜ëŠ” ê²ƒì´ë‹¤.

</aside>

## íƒˆì¤‘ì•™í™”ë¥¼ í•˜ëŠ” ì´ìœ 

![Centralized vs Decentralized](2022-03-12-etherbay/Untitled-1.png)

- ììœ ë¡­ê³  í‰ë“±í•œ ì°¸ì—¬ìë“¤ì— ì˜í•´ ììœ¨ì ìœ¼ë¡œ ìœ ì§€ë˜ê³  ìš´ì˜
- ë„¤íŠ¸ì›Œí¬ì— ì°¸ì—¬í•œ ëª¨ë“  ì‚¬ëŒë“¤ì˜ ê³¼ë°˜ìˆ˜ ì´ìƒì˜ ë™ì˜ë¥¼ í•„ìš”ë¡œ í•˜ëŠ” íƒˆì¤‘ì•™í™” ë°©ì‹
- ì¤‘ì•™í™”ëœ ê¸°ê´€ì´ë‚˜ ê¸°ì—…ë“¤ì€ ë‹´í•©í•˜ì—¬ ì œ3ìë¥¼ ì–µì••í•  ìˆ˜ ìˆì§€ë§Œ, íƒˆì¤‘ì•™í™”ëœ ì‹œìŠ¤í…œì˜ ì‚¬ìš©ìë“¤ì€ ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ì—ê²Œ í”¼í•´ë¥¼ ë¼ì³ ì´ë“ì„ ì·¨í•˜ê¸° ì–´ë µë‹¤.
- ì¤‘ì•™í™”ëœ ì‹œìŠ¤í…œì— ë¹„í•´ í•´í‚¹í•˜ëŠ”ë° ë¹„ìš©ê³¼ ì‹œê°„ì´ ë§ì´ ë“ ë‹¤.
- ë§ì€ ìˆ˜ì˜ ë°ì´í„°ë² ì´ìŠ¤ê°€ ë…ë¦½ë˜ì–´ ìˆì–´ ì¥ì• ê°€ ë°œìƒí•  í™•ë¥ ì´ ë‚®ë‹¤.

# ì´ë”ë¦¬ì›€(Ethereum)

---

ë¸”ë¡ì²´ì¸ ê¸°ë°˜ì— ìŠ¤ë§ˆíŠ¸ ê³„ì•½ì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ í”Œë«í¼

<aside>
ğŸ’¡ **ë¸”ë¡ì²´ì¸(Blockchain)**ì´ë€, ë¸”ë¡ì´ë¼ëŠ” ì •ë³´ë“¤ì— ì§‘í•©ì„ ì²´ì¸ì²˜ëŸ¼ ì—°ê²°í•˜ê³  ë³µì‚¬í•œ ë’¤ P2P ë°©ì‹ìœ¼ë¡œ ì—¬ëŸ¬ ì»´í“¨íŒ… í™˜ê²½ì— ì €ì¥í•˜ëŠ” ë¶„ì‚° ë°ì´í„° ì €ì¥ ê¸°ìˆ ì´ë‹¤.

</aside>

ë¹„íŠ¸ì½”ì¸ì„ ê¸°ë°˜ìœ¼ë¡œí•œ ëŒ€í‘œì ì¸ ì•ŒíŠ¸ì½”ì¸(ë¹„íŠ¸ì½”ì¸Â ì´ì™¸ì˜ ëŒ€ì•ˆì  ì•”í˜¸í™”í)ìœ¼ë¡œ â€œë¹„íŠ¸ì½”ì¸ 2.0â€ì´ë¼ê³  ë¶€ë¥¸ë‹¤.

## ìŠ¤ë§ˆíŠ¸ ê³„ì•½(ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸, Smart Contract)

ê¸°ì¡´ ë¹„íŠ¸ì½”ì¸ì˜ ë¸”ë¡ì²´ì¸ ê¸°ìˆ ì„ ê·¸ëŒ€ë¡œ ê³„ìŠ¹í•  ë¿ ì•„ë‹ˆë¼ ê¸ˆìœµê±°ë˜, ë¶€ë™ì‚° ê³„ì•½, ê³µì¦ ë“± ë‹¤ì–‘í•œ í˜•íƒœë¡œ ê³„ì•½ì„ ì²´ê²°í•˜ê³  ì´í–‰í•˜ëŠ” ê²ƒì„ ìŠ¤ë§ˆíŠ¸ ê³„ì•½ì´ë¼ê³  í•œë‹¤. ì´ë¡œ ì¸í•´ ë¸”ë¡ì²´ì¸ì€ ê³¼ê±°ì˜ ì •ë³´ë¥¼ ë³´ì¡´í•˜ëŠ” ê²ƒì—ì„œ ë¯¸ë˜ì— ì €ì¥ë  ì •ë³´ë“¤ë„ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.

í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œ ì‘ì„±ëœ ìŠ¤ë§ˆíŠ¸ ê³„ì•½ì€ ì½”ë“œì— ì íŒ ì¡°ê±´ì´ ë§Œì¡±ë˜ë©´ ê·¸ ì¦‰ì‹œ ê³„ì•½ì´ ì„±ì‚¬ëœë‹¤. ì–´ë– í•œ ë‹¤ìš´íƒ€ì„, ê²€ì—´, ì‚¬ê¸° í–‰ìœ„, ì œ3ì ê°„ì„­ ì—†ì´ í”„ë¡œê·¸ë˜ë°ëœ ëŒ€ë¡œ ì •í™•íˆ ì‹¤í–‰ëœë‹¤.

![ê¸°ì¡´ ê³„ì•½ ì²´ì œì˜ ê²½ìš° ì€í–‰ ë“± ì œ3ìì˜ ê°œì…ì´ í•„ìš”í•˜ì§€ë§Œ, ë¸”ë¡ì²´ì¸ ë•ë¶„ì— ì–´ë– í•œ í•´í‚¹ì˜ ìœ„í—˜ë„ ì—†ì´ ê²€ì¦ì´ ê°€ëŠ¥í•˜ë‹¤.](2022-03-12-etherbay/Untitled-2.png)

ê¸°ì¡´ ê³„ì•½ ì²´ì œì˜ ê²½ìš° ì€í–‰ ë“± ì œ3ìì˜ ê°œì…ì´ í•„ìš”í•˜ì§€ë§Œ, ë¸”ë¡ì²´ì¸ ë•ë¶„ì— ì–´ë– í•œ í•´í‚¹ì˜ ìœ„í—˜ë„ ì—†ì´ ê²€ì¦ì´ ê°€ëŠ¥í•˜ë‹¤.

ì‘ì„±ëœ ìŠ¤ë§ˆíŠ¸ ê³„ì•½ì€ ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì— ì €ì¥ëœë‹¤. ì–´ë– í•œ ìˆ˜ì •ê³¼ ì‚­ì œë„ í•  ìˆ˜ ì—†ê³ , ìŠ¤ë§ˆíŠ¸ ê³„ì•½ì— ì‘ì„±ëœ ì½”ë“œ ê·¸ëŒ€ë¡œ ì´í–‰ëœë‹¤. ê³„ì•½ëœ ë‚´ì—­ë“¤ ë˜í•œ ìˆ˜ì •&ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•œì²´ë¡œ ì´ë”ë¦¬ì›€ ë¸”ë¡ì²´ì¸ì— íŠ¸ëœì­ì…˜ì´ë¼ëŠ” í˜•íƒœë¡œ ì €ì¥ëœë‹¤.

<aside>
ğŸ’¡ ì´ëŸ° íƒˆì¤‘ì•™í™”ëœ í”„ë¡œê·¸ë¨ë“¤ì„ **ë””ì•± ë˜ëŠ” ëŒ‘(DApp, Decentralized Application)**ì´ë¼ê³  í•œë‹¤.

</aside>

# ê°œë°œí™˜ê²½ ì†Œê°œ

---

ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì— ê°œë°œëœ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•˜ë ¤ë©´ ìˆ˜ìˆ˜ë£Œ(ê°€ìŠ¤ë¹„ìš©, Gas Fee)ë¥¼ ì§€ë¶ˆí•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì´ë”ë¦¬ì›€ ìˆ˜ìˆ˜ë£ŒëŠ” ë§Œë§Œì¹˜ ì•Šê¸° ë•Œë¬¸ì— ë°°í¬ì™€ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ë¡œì»¬ ê°œë°œí™˜ê²½ê³¼ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±í•  í•„ìš”ê°€ ìˆë‹¤.

![2022ë…„ 1ì›” 21ì¼ ê¸°ì¤€, ìµœëŒ€(127Gwei) ë¹„ìš©ì„ ì„¤ì •í•  ê²½ìš° 22$ë¥¼ ì§€ë¶ˆí•´ì•¼ í•œë‹¤.](2022-03-12-etherbay/Untitled-3.png)

2022ë…„ 1ì›” 21ì¼ ê¸°ì¤€, ìµœëŒ€(127Gwei) ë¹„ìš©ì„ ì„¤ì •í•  ê²½ìš° 22$ë¥¼ ì§€ë¶ˆí•´ì•¼ í•œë‹¤.

<aside>
ğŸ’¡ **ê°€ìŠ¤ ë¹„ìš©(Gas fee)**ì´ë€, ì†¡ê¸ˆ ë˜ëŠ” ìŠ¤ë§ˆíŠ¸ ê³„ì•½ì„ ì‹¤í–‰í•  ë•Œ ìˆ˜ìˆ˜ë£Œë¥¼ ì±…ì •í•˜ê¸° ìœ„í•´ ë§Œë“  ë‹¨ìœ„ì´ë‹¤. ì´ë”ì˜ í•˜ìœ„ ë‹¨ìœ„ì¸ Gweië¡œ ê³„ì‚°ëœë‹¤. ê°€ìŠ¤ ë¹„ìš©ì´ ë“œëŠ” ì´ìœ ëŠ” ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•œ ì´ìœ ë„ ìˆì§€ë§Œ, ê³ ì˜ì ìœ¼ë¡œ ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì— ì•…ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” í–‰ìœ„ë¥¼ ë§‰ê¸° ìœ„í•´ì„œì´ë‹¤.
ì¼ë°˜ ì†¡ê¸ˆì„ í¬í•¨í•œ ëª¨ë“  íŠ¸ëœì­ì…˜ì€ 21000ê°€ìŠ¤ê°€ ì†Œëª¨ë˜ë©°, íŠ¸ëœì­ì…˜ í˜¸ì¶œì€ ì½”ë“œ í¬ê¸°ì— ë”°ë¼ ì¶”ê°€ë¡œ ê°€ìŠ¤ ë¹„ìš©ì„ ìš”êµ¬í•œë‹¤.
ê°€ìŠ¤ ë¹„ìš©ì´ ë“œëŠ” ì´ìœ ëŠ” ë°ì´í„°ë¥¼ ì˜®ê¸°ê³  ë¸”ë¡ì„ ì¦ëª…í•˜ëŠ” ì±„êµ´ìë“¤ì˜ ì—°ì‚° ì‘ì—…ì´ í•„ìš”í•œë°, ë³´ìƒìœ¼ë¡œ ì´ë”ë¦¬ì›€ ê°€ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ë•Œë¬¸ì´ë‹¤.

</aside>

## Hardhat

ìŠ¤ë§ˆíŠ¸ ê³„ì•½ì„ ì»´íŒŒì¼, ë°°í¬ ë° í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ê°œë°œ í™˜ê²½ìœ¼ë¡œ ë°˜ë³µ ì‘ì—… ê´€ë¦¬ì™€ ìë™í™”ì— ìµœì í™”ë˜ì–´ ìˆë‹¤.

ê°œë°œìš©ìœ¼ë¡œ ì„¤ê³„ëœ ë¡œì»¬ ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬(Hardhat network)ê°€ ë‚´ì¥ë˜ì–´ ìˆì–´ ê°€ìŠ¤ ë¹„ìš© ì—†ì´ ìŠ¤ë§ˆíŠ¸ ê³„ì•½ì„ ë°°í¬í•˜ê±°ë‚˜, JavaScript ê¸°ë°˜ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ì¸ mochaë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ìë™í™” í•  ìˆ˜ ìˆë‹¤.

## ì†”ë¦¬ë””í‹°(Solidity)

ì†”ë¦¬ë””í‹°ëŠ” ì´ë”ë¦¬ì›€ ë“±ê³¼ ê°™ì€ ë¸”ë¡ì²´ì¸ í”Œë«í¼ ìœ„ì—ì„œ ìŠ¤ë§ˆíŠ¸ ê³„ì•½ êµ¬í˜„ì„ ìœ„í•´ ê°œë°œëœ *ê³„ì•½ ì§€í–¥ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì´ë‹¤. EVM(ì´ë”ë¦¬ì›€ ê°€ìƒë¨¸ì‹ , Ethereum Virtual Machine)ì´ë¼ëŠ” íƒ€ê¹ƒìœ¼ë¡œ ë””ìì¸ëœ ì†”ë¦¬ë””í‹°ëŠ” ìƒì†, ë¼ì´ë¸ŒëŸ¬ë¦¬, íƒ€ì… ì •ì˜ ë“±ì„ ì§€ì›í•œë‹¤.

ê·¸ ë°–ì— EVMì„ íƒ€ê¹ƒìœ¼ë¡œ ì„¤ê³„ëœ Serpent, LLL, Viper ë“±ì˜ ì–¸ì–´ê°€ ìˆë‹¤.

<aside>
ğŸ’¡ ì†”ë¦¬ë””í‹°ë¥¼ **ê³„ì•½ ì§€í–¥** ì´ë¼ê³  ì†Œê°œí•˜ê³  ìˆëŠ”ë° ìë™í™”ëœ ê³„ì•½ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤. ì‹¤ìƒì€ ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì´ë‹¤.

</aside>

# ê°œë°œí™˜ê²½ ì„¤ì •í•˜ê¸°

---

Node.jsë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ê¸° ë•Œë¬¸ì— Node.js ì„¤ì¹˜ëŠ” í•„ìˆ˜ì´ë‹¤.

Hardhatì„ ì‚¬ìš©í•˜ì—¬ ê°œë°œí™˜ê²½ì„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì€ ë§¤ìš° ì‰½ë‹¤. npxë¥¼ ì´ìš©í•˜ì—¬ ëª…ë ¹ì–´ë‚˜ í”Œë«í¼ ì„¤ì¹˜ ì—†ì´ ë°”ë¡œ í™˜ê²½ì„¤ì •ì´ ê°€ëŠ¥í•˜ë‹¤.

`etherbay-contract` ë¼ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ê³  hardhat ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰íŒë‹¤. `npx hardhat`

```bash
~ $ mkdir etherbay-contract && cd etherbay-contract
etherbay-contract $ npx hardhat
In file included from ../src/secp256k1/src/secp256k1.c:12:
../src/secp256k1/src/field_impl.h:266:13: warning: unused function 'secp256k1_fe_inv_all_var' [-Wunused-function]
static void secp256k1_fe_inv_all_var(secp256k1_fe *r, const secp256k1_fe *a, size_t len) {
            ^
In file included from ../src/secp256k1/src/secp256k1.c:14:
../src/secp256k1/src/group_impl.h:202:13: warning: unused function 'secp256k1_ge_set_infinity' [-Wunused-function]
static void secp256k1_ge_set_infinity(secp256k1_ge *r) {
            ^
../src/secp256k1/src/group_impl.h:691:12: warning: unused function 'secp256k1_gej_has_quad_y_var' [-Wunused-function]
static int secp256k1_gej_has_quad_y_var(const secp256k1_gej *a) {
           ^
../src/secp256k1/src/group_impl.h:272:12: warning: unused function 'secp256k1_gej_is_valid_var' [-Wunused-function]
static int secp256k1_gej_is_valid_var(const secp256k1_gej *a) {
           ^
In file included from ../src/secp256k1/src/secp256k1.c:15:
../src/secp256k1/src/ecmult_impl.h:1168:12: warning: unused function 'secp256k1_ecmult_multi_var' [-Wunused-function]
static int secp256k1_ecmult_multi_var(const secp256k1_callback* error_callback, const secp256k1_ecmult_context *ctx, secp256k1_scratch *scratch, secp256k1_gej *r, const secp256k1_scalar *inp_g_sc, secp256k1_ecmult_multi_callback cb, void *cbdata, size_t n) {
           ^
../src/secp256k1/src/ecmult_impl.h:695:12: warning: unused function 'secp256k1_ecmult_strauss_batch_single' [-Wunused-function]
static int secp256k1_ecmult_strauss_batch_single(const secp256k1_callback* error_callback, const secp256k1_ecmult_context *actx, secp256k1_scratch *scratch, secp256k1_gej *r, const secp256k1_scalar *inp_g_sc, secp256k1_ecmult_multi_callback cb, void *cbdata, size_t n) {
           ^
../src/secp256k1/src/ecmult_impl.h:982:15: warning: unused function 'secp256k1_pippenger_scratch_size' [-Wunused-function]
static size_t secp256k1_pippenger_scratch_size(size_t n_points, int bucket_window) {
              ^
../src/secp256k1/src/ecmult_impl.h:1075:12: warning: unused function 'secp256k1_ecmult_pippenger_batch_single' [-Wunused-function]
static int secp256k1_ecmult_pippenger_batch_single(const secp256k1_callback* error_callback, const secp256k1_ecmult_context *actx, secp256k1_scratch *scratch, secp256k1_gej *r, const secp256k1_scalar *inp_g_sc, secp256k1_ecmult_multi_callback cb, void *cbdata, size_t n) {
           ^
8 warnings generated.
888    888                      888 888               888
888    888                      888 888               888
888    888                      888 888               888
8888888888  8888b.  888d888 .d88888 88888b.   8888b.  888888
888    888     "88b 888P"  d88" 888 888 "88b     "88b 888
888    888 .d888888 888    888  888 888  888 .d888888 888
888    888 888  888 888    Y88b 888 888  888 888  888 Y88b.
888    888 "Y888888 888     "Y88888 888  888 "Y888888  "Y888

ğŸ‘· Welcome to Hardhat v2.8.3 ğŸ‘·â€

? What do you want to do? â€¦ 
â¯ Create a basic sample project
  Create an advanced sample project
  Create an advanced sample project that uses TypeScript
  Create an empty hardhat.config.js
  Quit
```

ì„¤ì¹˜ ì¤€ë¹„ê°€ ì™„ë£Œë˜ë©´ í”„ë¡œì íŠ¸ì˜ í˜•íƒœë¥¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤. ê¸°ë³¸ì„¤ì •ê³¼ ê³ ê¸‰ì„¤ì •, íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì§€ì› ë“± ì•„ë¬´ê±°ë‚˜ ì„ íƒí•´ë„ ë˜ì§€ë§Œ `Create an empty hardhat.config.js` ëŠ” ì„¤ì •íŒŒì¼ë§Œ ìˆëŠ” ë¹ˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ê°€ëŠ¥í•˜ë©´ ì„ íƒí•˜ì§€ ì•ŠëŠ” ê±¸ ì¶”ì²œí•œë‹¤.(ê³ ê¸‰ ì‚¬ìš©ììš©)

```bash
ğŸ‘· Welcome to Hardhat v2.8.3 ğŸ‘·â€

âœ” What do you want to do? Â· Create a basic sample project
âœ” Hardhat project root: Â· /Users/seondev/Projects/etherbay-contract
âœ” Do you want to add a .gitignore? (Y/n) Â· y
âœ” Do you want to install this sample project's dependencies with npm (hardhat @nomiclabs/hardhat-waffle ethereum-waffle chai @nomiclabs/hardhat-ethers ethers)? (Y/n) Â· y

npm install --save-dev hardhat@^2.8.3 @nomiclabs/hardhat-waffle@^2.0.0 ethereum-waffle@^3.0.0 chai@^4.2.0 @nomiclabs/hardhat-ethers@^2.0.0 ethers@^5.0.0
...
etherbay-contract $ ls -al
total 32
drwxr-xr-x   9 seondev  staff  288  1 22 12:37 .
drwx------  22 seondev  staff  704  1 22 12:31 ..
-rw-r--r--   1 seondev  staff   83  1 22 12:37 .gitignore
-rw-r--r--   1 seondev  staff  467  1 22 12:37 README.md
drwxr-xr-x   3 seondev  staff   96  1 22 12:37 contracts
-rw-r--r--   1 seondev  staff  572  1 22 12:37 hardhat.config.js
-rw-r--r--   1 seondev  staff   32  1 22 12:34 package.json
drwxr-xr-x   3 seondev  staff   96  1 22 12:37 scripts
drwxr-xr-x   3 seondev  staff   96  1 22 12:37 test
```

[Hardhat í”„ë¡œì íŠ¸ êµ¬ì¡°](https://www.notion.so/10c1e927e02d4300a9edb40127e3e1be)

### ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì»´íŒŒì¼ë§

ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì„¤ì¹˜í•  ê²½ìš° `Greeter.sol` íŒŒì¼ì´ ìƒì„±ë˜ì–´ ìˆë‹¤.

```solidity
//SPDX-License-Identifier: Unlicense
pragma solidity ^0.8.0;

import "hardhat/console.sol";

contract Greeter {
    string private greeting;

    constructor(string memory _greeting) {
        console.log("Deploying a Greeter with greeting:", _greeting);
        greeting = _greeting;
    }

    function greet() public view returns (string memory) {
        return greeting;
    }

    function setGreeting(string memory _greeting) public {
        console.log("Changing greeting from '%s' to '%s'", greeting, _greeting);
        greeting = _greeting;
    }
}
```

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»´íŒŒì¼ í•  ìˆ˜ ìˆë‹¤.

```bash
$ npx hardhat compile
```

### ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ í…ŒìŠ¤íŒ…

ì´ë”ë¦¬ì›€ì€ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ì— ì‘ì„±ëœ ì½”ë“œì˜ íš¨ìœ¨ì„±ì— ë”°ë¼ ê°€ìŠ¤ ë¹„ìš©ì´ ë§ì´ ë°œìƒí•˜ê±°ë‚˜ ë‚®ê²Œ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ë•Œë¬¸ì— ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ê°œë°œí•  ë•ŒëŠ” í…ŒìŠ¤íŠ¸ ìœ„ì£¼ í”„ë¡œê·¸ë˜ë°ì„ í•˜ëŠ”ë°, hardhatì—ì„œ ì œê³µí•˜ëŠ” mochaì™€ chaië¥¼ ì´ìš©í•´ë³´ì

`test/` ë””ë ‰í† ë¦¬ì— `sample-test.js` íŒŒì¼ì„ ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```jsx
const { expect } = require("chai");
const { ethers } = require("hardhat");

describe("Greeter", function () {
  it("Should return the new greeting once it's changed", async function () {
    const Greeter = await ethers.getContractFactory("Greeter");
    const greeter = await Greeter.deploy("Hello, world!");
    await greeter.deployed();

    expect(await greeter.greet()).to.equal("Hello, world!");

    const setGreetingTx = await greeter.setGreeting("Hola, mundo!");

    // wait until the transaction is mined
    await setGreetingTx.wait();

    expect(await greeter.greet()).to.equal("Hola, mundo!");
  });
});
```

ì•„ë˜ ëª…ë ¹ì–´ë¡œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. `npx hardhat test`

```bash
etherbay-contract $ npx hardhat test

Greeter
Deploying a Greeter with greeting: Hello, world!
Changing greeting from 'Hello, world!' to 'Hola, mundo!'
    âœ“ Should return the new greeting once it's changed (350ms)

  1 passing (353ms)

etherbay-contract $
```

### ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ë°°í¬

`scripts/` ë””ë ‰í† ë¦¬ë¥¼ ë³´ë©´ `sample-script.js` íŒŒì¼ì´ ìˆë‹¤. hardhatì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ë°°í¬ë¥¼ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‚¬ìš©ë˜ì–´ ìˆë‹¤.

```jsx
// We require the Hardhat Runtime Environment explicitly here. This is optional
// but useful for running the script in a standalone fashion through `node <script>`.
//
// When running the script with `npx hardhat run <script>` you'll find the Hardhat
// Runtime Environment's members available in the global scope.
const hre = require("hardhat");

async function main() {
  // Hardhat always runs the compile task when running scripts with its command
  // line interface.
  //
  // If this script is run directly using `node` you may want to call compile
  // manually to make sure everything is compiled
  // await hre.run('compile');

  // We get the contract to deploy
  const Greeter = await hre.ethers.getContractFactory("Greeter");
  const greeter = await Greeter.deploy("Hello, Hardhat!");

  await greeter.deployed();

  console.log("Greeter deployed to:", greeter.address);
}

// We recommend this pattern to be able to use async/await everywhere
// and properly handle errors.
main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
```

ì‘ì„±ëœ ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•œë‹¤. `npx hardhat run scripts/sample-script.js`

```bash
etherbay-contract $ npx hardhat run scripts/sample-script.js
Deploying a Greeter with greeting: Hello, Hardhat!
Greeter deployed to: 0x5FbDB2315678afecb367f032d93F642f64180aa3
```

### hardhat ë…ë¦½ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°í•˜ê¸°

hardhatì—ì„œ ì œê³µí•˜ëŠ” ë„¤íŠ¸ì›Œí¬ëŠ” EVMì„ ëª¨ë°©í•˜ì—¬ ë¡œì»¬ í™˜ê²½ì—ì„œ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰í•œë‹¤. ì´ëŸ° ë…ë¦½ ë„¤íŠ¸ì›Œí¬ëŠ” ë©”ëª¨ë¦¬ì— ìƒì£¼í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤í™” ë˜ì–´ìˆë‹¤. ì‹¤í–‰ëœ hardhat ë„¤íŠ¸ì›Œí¬ëŠ” HTTP ë˜ëŠ” JSON-RPCë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì™€ ìš”ì²­ì„ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆë‹¤.

`npx hardhat node` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

```bash
etherbay-contract $ npx hardhat node
Started HTTP and WebSocket JSON-RPC server at http://127.0.0.1:8545/

Accounts
========

WARNING: These accounts, and their private keys, are publicly known.
Any funds sent to them on Mainnet or any other live network WILL BE LOST.

Account #0: 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 (10000 ETH)
Private Key: 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80

Account #1: 0x70997970c51812dc3a010c7d01b50e0d17dc79c8 (10000 ETH)
Private Key: 0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d

Account #2: 0x3c44cdddb6a900fa2b585dd299e03d12fa4293bc (10000 ETH)
Private Key: 0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a

...

WARNING: These accounts, and their private keys, are publicly known.
Any funds sent to them on Mainnet or any other live network WILL BE LOST.
```

ì‹¤í–‰ëœ ë…ë¦½ ë„¤íŠ¸ì›Œí¬ì— ë‚´ê°€ ì‘ì„±í•œ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•˜ë ¤ë©´ `--network localhost` ì˜µì…˜ì„ ì¶”ê°€í•˜ë©´ ëœë‹¤.

```bash
etherbay-contract $ npx hardhat run scripts/sample-script.js --network localhost
```

# etherBay ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ êµ¬ì„±í•˜ê¸°

---

ì´ë² ì´ëŠ” ì˜¤í”ˆë§ˆì¼“ ì„œë¹„ìŠ¤ë¡œ ëˆ„êµ¬ë‚˜ ìƒí’ˆì„ íŒë§¤í•˜ê³  êµ¬ë§¤í•  ìˆ˜ ìˆë‹¤. ë•Œë¬¸ì— íŒë§¤ìëŠ” ìƒí’ˆì„ ëˆ„êµ¬ë‚˜ ë¬´ë£Œë¡œ ì˜¬ë¦´ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ê³ , êµ¬ë§¤ìëŠ” ìƒí’ˆì„ êµ¬ë§¤í•˜ëŠ” ê¸°ëŠ¥ì„ ì»¨íŠ¸ë™íŠ¸ë¡œ êµ¬í˜„í•œë‹¤.

ì´ë² ì´ì˜ ì¥ì  ì¤‘ í•˜ë‚˜ëŠ” ì‚¬ê¸° ë°©ì§€ ê¸°ëŠ¥ì¸ë°, êµ¬ë§¤ì ì…ê¸ˆ í›„ íŒë§¤ìê°€ ë¬¼ê±´ì„ ë³´ë‚´ì§€ ì•Šì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ êµ¬ë§¤ìê°€ ì—ìŠ¤í¬ë¡œì— ì…ê¸ˆí•˜ê²Œ í•œ í›„ íŒë§¤ìê°€ ë¬¼ê±´ì„ ë³´ë‚´ë©´ ìµœì¢…ì ìœ¼ë¡œ íŒë§¤ìì—ê²Œ ì…ê¸ˆí•˜ê²Œ ë˜ì–´ìˆë‹¤. ì´ ì—ìŠ¤í¬ë¡œì˜  ê¸°ëŠ¥ì„ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ê°€ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤.

![Untitled](2022-03-12-etherbay/Untitled-4.png)

ì„œë“œíŒŒí‹° ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ê°€ êµ¬ë§¤ ê¸ˆì•¡ì„ í™•ì¸í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆì§€ë§Œ, íƒˆì¤‘ì•™í™”ë¥¼ ìœ„í•´ ê±°ë˜ ëŒ€ê¸ˆì€ ì´ë”(ETH)ë¡œ ëŒ€ì²´í•œë‹¤.

<aside>
ğŸ’¡ ì´ë”(ETH)ë€, ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì˜ ê¸°ë³¸ í†µí™”ë¡œ ë¹„íŠ¸ì½”ì¸ê³¼ ê°™ì€ â€œë””ì§€í„¸ í™”íâ€ì´ë‹¤. ì´ë”ë¦¬ì›€ ê¸°ë°˜ì˜ ë””ì•±ë“¤ì€ ì´ë”ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ë° ê±°ë˜ ë“±ì— ì‚¬ìš©ë˜ê³  ìˆë‹¤. ì´ë”ë¦¬ì›€ì˜ ì±„êµ´ìë“¤ì€ ì±„êµ´ì˜ ë³´ìƒìœ¼ë¡œ ì´ë”ë¥¼ ì§€ê¸‰ë°›ëŠ”ë‹¤.

</aside>

etherBay ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ê°€ í•˜ëŠ” ì¼ì„ ì •ë¦¬í•˜ìë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

- íŒë§¤ ë¬¼ê±´ì— ëŒ€í•œ ì •ë³´ë¥¼ ì´ë”ë¦¬ì›€ ìƒì— ì €ì¥í•˜ê¸° â†’ íŠ¸ëœì­ì…˜ ì €ì¥
- íŒë§¤ ë¬¼ê±´ êµ¬ë§¤í•˜ê¸° â†’ ì´ë” ì…ê¸ˆ
- êµ¬ë§¤ì ë¬¼ê±´ í™•ì¸ ì™„ë£Œ â†’ íŒë§¤ìì—ê²Œ ì´ë” ì „ì†¡

## ProductFactory ì»¨íŠ¸ë™íŠ¸

`contract` ëŠ” ì†”ë¦¬ë””í‹°ì˜ ê¸°ë³¸ì ì¸ êµ¬ì„±ìœ¼ë¡œ ìŠ¤ë§ˆíŠ¸ ê³„ì•½ ìì²´ë¥¼ ì˜ë¯¸í•œë‹¤. ëª¨ë“  ì†”ë¦¬ë””í‹° ì½”ë“œëŠ” `contract` ì•ˆì— ì‘ì„±í•œë‹¤.

ìš°ë¦¬ê°€ ë§Œë“¤ ì²«ë²ˆì§¸ ê¸°ëŠ¥ì€ **íŒë§¤ìê°€ ì˜¬ë¦° ë¬¼ê±´ì„ ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì— ì €ì¥**í•˜ëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ ë³¼ ê²ƒì´ë‹¤. ì´ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” ì»¨íŠ¸ë™íŠ¸ ì´ë¦„ì€ `ProductFactory` ë¼ê³  í•˜ê² ë‹¤.

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract ProductFactory {
}
```

### Version Pragma

ì†”ë¦¬ë””í‹° ì½”ë“œë¥¼ ì‘ì„±í•  ë•ŒëŠ” ì œì¼ ë¨¼ì € `pragama solidity ^0.8.0` ì™€ ê°™ì´ ì†”ë¦¬ë””í‹° ë²„ì „ì„ ì„ ì–¸í•´ì•¼ í•œë‹¤. ì´ë¥¼ í†µí•´ ìƒˆë¡œìš´ ë²„ì „ì´ ë‚˜ì™€ë„ ê¸°ì¡´ ì½”ë“œì™€ í˜¸í™˜í•˜ë„ë¡ ì˜ˆë°©í•  ìˆ˜ ìˆë‹¤.

ì†”ë¦¬ë””í‹°ëŠ” ê°œë°œëœì§€ ì–¼ë§ˆë˜ì§€ ì•Šì€ ì–¸ì–´ì´ê¸° ë•Œë¬¸ì— ì•„ì§ ì•ˆì •í™”ê°€ ë˜ì§€ ì•Šì€ ìƒíƒœì´ë‹¤. ìƒˆë¡œìš´ ë²„ì „ì´ ë‚˜ì˜¬ë•Œë§ˆë‹¤ ê¸°ì¡´ ë¬¸ë²•ì´ ë°”ë€Œê±°ë‚˜ ìƒˆë¡œìš´ ë¬¸ë²•ì´ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì— ë²„ì „ ì„¤ì •ì€ ì¤‘ìš”í•˜ë‹¤.

### ìƒíƒœ ë³€ìˆ˜ë¡œ ìƒí’ˆ ì •ë³´ ì €ì¥

ìƒíƒœ ë³€ìˆ˜ëŠ” ì»¨íŠ¸ë™íŠ¸ ì €ì¥ì†Œì— ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥ëœë‹¤. ì¦‰, ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì— ê¸°ë¡ë˜ëŠ” ê²ƒì´ë‹¤.(ë°ì´í„°ë² ì´ìŠ¤ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•˜ë‹¤.)

íŒë§¤ ìƒí’ˆì„ ì˜¬ë¦¬ê¸°ìœ„í•´ ì €ì¥ë  ì •ë³´ëŠ” ì•„ë˜ì™€ ê°™ë‹¤. ì´ ì •ë³´ë“¤ì„ ìƒíƒœ ë³€ìˆ˜ë¡œ ë§Œë“¤ì–´ ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì— ìˆëŠ” ìš°ë¦¬ ì»¨íŠ¸ë™íŠ¸ ì €ì¥ì†Œì— ì €ì¥í•  ê²ƒì´ë‹¤.

- ìƒí’ˆëª…
- ì¹´í…Œê³ ë¦¬
- ìƒí’ˆ ì •ë³´
- ìƒí’ˆ ì´ë¯¸ì§€

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract ProductFactory {
  string name;
  string category;
  string description;
  string image;
}
```

ì´ëŸ¬í•œ ìƒí’ˆì˜ ì •ë³´ë“¤ì„ êµ¬ì¡°ì²´(struct)ë¡œ ë§Œë“¤ì–´ ì €ì¥í•˜ë©´ ë³µì¡í•œ ìë£Œí˜•ì„ ì •ë¦¬í•˜ëŠ”ë° ë„ì›€ì´ ëœë‹¤.

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract ProductFactory {
  struct Product {
    string name;
    string category;
    string description;
    string image;
  }
}
```

### ë°°ì—´, ìƒí’ˆ ìƒì„±í•˜ê¸°

ì†”ë¦¬ë””í‹°ì—ì„œ ë°°ì—´ì€ ì •ì  í• ë‹¹ê³¼ ë™ì  í• ë‹¹ì„ ì§€ì›í•œë‹¤.

```solidity
// 2ê°œì˜ ì›ì†Œë¥¼ ë‹´ì„ ìˆ˜ ìˆëŠ” ê³ ì • ê¸¸ì´ì˜ ë°°ì—´
uint[2] fixedArray;
// ë™ì  ë°°ì—´ì€ ê³ ì •ëœ í¬ê¸°ê°€ ì—†ìœ¼ë©° ê³„ì† í¬ê¸°ê°€ ì»¤ì§ˆ ìˆ˜ ìˆë‹¤
uint[] dynamicArray;
```

`Product` êµ¬ì¡°ì²´ë¥¼ ë™ì  ë°°ì—´ë¡œ ì¶”ê°€í•˜ì—¬ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¥¼ ì €ì¥ì‹œí‚¬ ìˆ˜ ìˆë‹¤.(ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ìƒì„±í•œë‹¤ê³  ìƒê°í•˜ë©´ ì´í•´í•˜ëŠ”ë° ë„ì›€ì´ ë  ê²ƒ ì´ë‹¤.)

```solidity
// ë°ì´í„°ë² ì´ìŠ¤ì²˜ëŸ¼ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¥¼ ì €ì¥ ì‹œí‚¬ ìˆ˜ ìˆì–´ ìœ ìš©í•˜ë‹¤.
Product[] products;
```

### ê°€ì‹œì„±(visiability), ìƒí’ˆ ì™¸ë¶€ ê³µê°œí•˜ê¸°

ê°€ì‹œì„±ì€ ì™¸ë¶€ ì¦‰, ë‹¤ë¥¸ ì»¨íŠ¸ë™íŠ¸ë‚˜ ì‚¬ìš©ìë“¤ì—ê²Œ í•´ë‹¹ ë°ì´í„°ë¥¼ ê³µê°œí• ì§€ ê²°ì •í•˜ëŠ” ì—¬ë¶€ì´ë‹¤. `external` `public` `private` `ineternal` ì´ 4ê°€ì§€ê°€ ìˆë‹¤.

- **external**: ì»¨íŠ¸ë™íŠ¸ ì™¸ë¶€ì—ì„œë§Œ í˜¸ì¶œì´ ê°€ëŠ¥í•˜ë‹¤.(ë‚´ë¶€ì—ì„œëŠ” í˜¸ì¶œì´ ë¶ˆê°€ëŠ¥)
- **public**: ë‚´ë¶€ì™€ ì™¸ë¶€ ëª¨ë‘ í˜¸ì¶œì´ ê°€ëŠ¥í•˜ë‹¤.
- **private**: ë‚´ë¶€ì—ì„œë§Œ í˜¸ì¶œì´ ê°€ëŠ¥í•˜ë‹¤.
- **internal**: ë‚´ë¶€ ë˜ëŠ” **ìƒì†**ëœ ì»¨íŠ¸ë™íŠ¸ì—ì„œ í˜¸ì¶œì´ ê°€ëŠ¥í•˜ë‹¤.

íŒë§¤ ìƒí’ˆì€ êµ¬ë§¤ìë“¤ì—ê²Œ ë³´ì—¬ì¤„ ìˆ˜ ìˆë„ë¡ publicìœ¼ë¡œ ì„ ì–¸í•œë‹¤.

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract ProductFactory {
  struct Product {
    string name;
    string category;
    string description;
    string image;
  }

	// ìƒí’ˆ ë°°ì—´ì„ ê³µê°œ ìƒíƒœë³€ìˆ˜ë¡œ ì„ ì–¸
	Product[] public products;
}
```

<aside>
ğŸ’¡ `external` ë¡œ ì„ ì–¸í•˜ì§€ ì•Šì€ ì´ìœ ëŠ” ë‹¤ìŒì—ì„œ ë‹¤ë£¨ì–´ë³¼ ìƒí’ˆ ì¶”ê°€ë¥¼ ìœ„í•´ `public`ìœ¼ë¡œ ì„ ì–¸í•˜ì˜€ë‹¤.

</aside>

### í•¨ìˆ˜ ì„ ì–¸, ìƒí’ˆ ìƒì„±í•˜ê¸°

í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ìƒí’ˆì„ ì¶”ê°€í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ìƒí’ˆì„ ìƒì„±í•˜ëŠ” ì£¼ì²´ëŠ” íŒë§¤ìë“¤ì´ë¯€ë¡œ ì™¸ë¶€ì—ì„œ ì»¨íŠ¸ë™íŠ¸ë¥¼ í˜¸ì¶œí•  í•„ìš”ê°€ ìˆë‹¤. ê³µê°œ í•¨ìˆ˜ë¡œ ì„ ì–¸í•˜ë„ë¡ í•˜ì

```solidity
// ìƒí’ˆì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜, ì™¸ë¶€ì—ì„œë§Œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— externalë¡œ ì§€ì •í•œë‹¤.
// ì†”ë¦¬ë””í‹°ì—ì„œëŠ” í•¨ìˆ˜ì— ê°€ì‹œì„±ê³¼ ê°™ì€ ê²ƒë“¤ì„ í•¨ìˆ˜ëª… ë‹¤ìŒì— ì§€ì •í•œë‹¤. ì´ëŸ° ê²ƒë“¤ì„ í•¨ìˆ˜ì— ì†ì„±ì´ë¼ê³  í•œë‹¤.
function createProduct() external {}
```

ìƒí’ˆì˜ ì •ë³´ë¥¼ ìœ„í•´ ì¸ìë¥¼ ì „ë‹¬ ë°›ì•„ì•¼í•œë‹¤.

```solidity
// "_"ëŠ” ì „ì—­ ë³€ìˆ˜ì™€ êµ¬ë³„ì„ ìœ„í•œ ê´€ë¡€ì´ë‹¤.(í•„ìˆ˜ëŠ” ì•„ë‹˜)
function createProduct(
	string calldata _name,
	string calldata _category,
	string calldata _description,
	string calldata _image
) external {}
```

`calldata` ëŠ” ë°ì´í„° ì €ì¥ ìœ„ì¹˜ë¥¼ ë§í•œë‹¤. ì†”ë¦¬ë””í‹°ì—ì„œëŠ” í•´ë‹¹ ë³€ìˆ˜ì˜ ì¶œì²˜ê°€ ì–´ë””ì¸ì§€ í•„ìˆ˜ì ìœ¼ë¡œ ëª…ì‹œí•´ ì£¼ì–´ì•¼í•œë‹¤.(ì†”ë¦¬ë””í‹° ë²„ì „ 0.5.0ì— ì¶”ê°€ë¨) ë°ì´í„° ì €ì¥ ìœ„ì¹˜ëŠ” ë°°ì—´(array), êµ¬ì¡°ì²´(struct), ë§¤í•‘(mapping, ì´ ê³¼ì •ì—ì„œ ë‹¤ë£° ì˜ˆì •), ë¬¸ìì—´(string)ë§Œ ì§€ì •í•œë‹¤.

ì €ì¥ ìœ„ì¹˜ëŠ” `calldata` `memory` `storage` 3ê°€ì§€ê°€ ìˆë‹¤.

- **calldata**: í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜(ì¸ì)ê°€ ì €ì¥ë˜ëŠ” ìœ„ì¹˜
- **memory**: ë©”ëª¨ë¦¬ì— ì €ì¥ë˜ëŠ” ë³€ìˆ˜, ìƒíƒœ ë³€ìˆ˜ë¥¼ ì œì™¸í•œ ëª¨ë“  ë³€ìˆ˜ë“¤ì€ memoryì— ìƒì£¼í•œë‹¤.
- **storage**: ìƒíƒœ ë³€ìˆ˜ê°€ ì €ì¥ë˜ëŠ” ìœ„ì¹˜

ì°¸ê³ ë¡œ `calldata` ëŠ” ìˆ˜ì • ë¶ˆê°€ëŠ¥í•˜ë©° ë©”ëª¨ë¦¬ì²˜ëŸ¼ ë™ì‘í•œë‹¤.

ì´ì œ ì „ë‹¬ ë°›ì€ ì¸ìë¡œ `Product` ìƒíƒœ ë³€ìˆ˜ì— ìƒí’ˆì„ ì¶”ê°€í•´ë³´ì

```solidity
function createProduct(
	string calldata _name,
	string calldata _category,
	string calldata _description,
	string calldata _image
) external {
	// ìƒí’ˆ êµ¬ì¡°ì²´ ìƒì„±
	Product memory newProduct = Product(_name, _category, _description, _image);
	// ìƒíƒœ ë³€ìˆ˜ì— ì¶”ê°€í•œë‹¤.
	// pushëŠ” ë°°ì—´ì— ê°’ì„ ë„£ì„ ë•Œ ì‚¬ìš©ëœë‹¤.
	products.push(newProduct);
}
```

### ì´ë²¤íŠ¸, ì‚¬ìš©ìì—ê²Œ ì•Œë¦¬ê¸°

ì´ë²¤íŠ¸ëŠ” ì»¨íŠ¸ë™íŠ¸ê°€ ë¸”ë¡ì²´ì¸ì—ì„œ ë¬´ì–¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì˜ì‚¬ì†Œí†µí•˜ëŠ” ë°©ë²•ì´ë‹¤. ì‚¬ìš©ìëŠ” ì»¨íŠ¸ë™íŠ¸ì—ì„œ íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ëŠ”ì§€ ê°ì§€í•˜ì—¬ í–‰ë™ì„ ì·¨í•œë‹¤.

```solidity
// ì´ë²¤íŠ¸ë¥¼ ì„ ì–¸í•œë‹¤.
event IntegersAdded(uint x, uint y, uint result);

function add(uint calldata _x, uint calldata _y) external returns(uint memory) {
  uint memory result = _x + _y;
  // ì´ë²¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ add í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì—ˆìŒì„ ì•Œë¦°ë‹¤.
  emit IntegersAdded(_x, _y, result);

  return result;
}
```

ìƒí’ˆì´ ìƒì„±ë˜ë©´ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¬ê¸°ìœ„í•´ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•œë‹¤.

ê·¸ë¦¬ê³  ì‚¬ìš©ìë“¤ì´ ì¶”ê°€ëœ ìƒí’ˆì„ ì°¾ê¸°ìœ„í•´ ë°°ì—´ì˜ ìƒ‰ì¸ì„ ì¶”ê°€í•œë‹¤.

```solidity
// ì´ë²¤íŠ¸ë¥¼ ì„ ì–¸í•œë‹¤.
event NewProduct(
    uint256 id,
    string name,
    string category,
    string description,
    string image
  );

function createProduct(
    string calldata _name,
    string calldata _category,
    string calldata _description,
    string calldata _image
  ) external {
    Product memory newProduct = Product(_name, _category, _description, _image);
    products.push(newProduct);

		// ì¶”ê°€ëœ ìƒí’ˆì˜ ìƒ‰ì¸, (uint256) ì •ìˆ˜ íƒ€ì…ì€ ì €ì¥ ìœ„ì¹˜ë¥¼ ì§€ì •í•´ ì¤„ í•„ìš”ê°€ ì—†ë‹¤.
    uint256 id = products.length - 1;
		// ìƒí’ˆì´ ì¶”ê°€ëœ í›„ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œë‹¤.
    emit NewProduct(id, _name, _category, _description, _image);
  }
```

ìµœì¢… ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract ProductFactory {
  event NewProduct(
    uint256 id,
    string name,
    string category,
    string description,
    string image
  );

  struct Product {
    string name;
    string category;
    string description;
    string image;
  }

  Product[] public products;

  function createProduct(
    string calldata _name,
    string calldata _category,
    string calldata _description,
    string calldata _image
  ) external {
    Product memory newProduct = Product(_name, _category, _description, _image);
    products.push(newProduct);

    uint256 id = products.length - 1;

    emit NewProduct(id, _name, _category, _description, _image);
  }
}
```

### í…ŒìŠ¤íŒ…, ìƒí’ˆ ì¶”ê°€ & ìƒí’ˆ í™•ì¸í•˜ê¸°

ìƒí’ˆ ì¶”ê°€ë¥¼ ìœ„í•œ ê¸°ë³¸ì ì¸ ì†”ë¦¬ë””í‹° ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì•˜ë‹¤. Hardhatì—ì„œ ì§€ì›í•˜ëŠ” í…ŒìŠ¤íŒ… íˆ´ì„ ì´ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ë³´ì.

ì•„ë˜ëŠ” í…ŒìŠ¤íŒ…ì„ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œì´ë‹¤.

```solidity
const { expect } = require('chai');
const { ethers } = require('hardhat');

describe('ProductFactory', async function () {
  let productFactory;
  let newProductEvents = [];

  const product = [
    'MacBook-pro M1X 16inch',
    'apple',
    'MacBook-pro M1X 16inch, Space Gray, 64GB Memory, 8TB SSD Storage, Pre-Installed "Final Cut Pro" and "Logic Pro"',
    'https://store.storeimages.cdn-apple.com/8756/as-images.apple.com/is/mbp16-spacegray-gallery2-202110?wid=4000&hei=3072&fmt=jpeg&qlt=80&.v=1632799174000',
  ];

  before(async function () {
    const Factory = await ethers.getContractFactory('ProductFactory');
    const factory = await Factory.deploy();
    await factory.deployed();

    productFactory = factory;
  });

  it('#1 ìƒí’ˆ ìƒì„±í•˜ê¸°', async function () {
    const createProduct = await productFactory.createProduct(...product);

    const receipt = await createProduct.wait();

    const events = receipt.events.filter((x) => {
      return x.event == 'NewProduct';
    });
    newProductEvents = events;

    expect(events).to.not.length(0);
  });

  it('#2 ì¶”ê°€ëœ ìƒí’ˆ ì¡°íšŒí•˜ê¸°', async function () {
    const lastEvent = newProductEvents.pop();
    const productId = lastEvent.args.id.toNumber();

    const { name, category, description, image, ...hot } = await productFactory.products(productId);
    const newProduct = Object.values(hot);

    expect(newProduct).deep.to.equal(product);
  });
});
```

í•´ë‹¹ ìŠ¤í¬ë¦½íŠ¸ëŠ” ìƒí’ˆ ìƒì„± í›„ ìƒì„±ëœ ìƒí’ˆì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤. ë¬¸ì œê°€ ìˆëŠ” ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ì—¬ ì»¨íŠ¸ë™íŠ¸ë¥¼ ìˆ˜ì •í•˜ì.

etherBay ì»¨íŠ¸ë™íŠ¸ ì†ŒìŠ¤ì½”ë“œëŠ” [github](https://github.com/boy672820/etherbay-contract)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

# í‘œì¤€í™”, í† í° ì»¨íŠ¸ë™íŠ¸ì™€ ìƒí˜¸ì‘ìš©í•˜ê¸°

---

ì´ë”ë¦¬ì›€ì—ëŠ” ERC20, ERC721ê³¼ ê°™ì€ í† í°ì´ë¼ëŠ” ê°œë…ì´ ìˆë‹¤. ì‰½ê²Œ ë§í•´ ìŠ¤ë§ˆíŠ¸ ê³„ì•½ìœ¼ë¡œ êµ¬í˜„ëœ ë””ì§€í„¸ í™”íë¡œ ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì •í•œ í‘œì¤€ ìŠ¤í™ì´ ì¡´ì¬í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `transfer` `balanceOf` `ownerOf` ì™€ ê°™ì€ í•¨ìˆ˜ë“¤ì´ ìˆë‹¤.

<aside>
ğŸ’¡ **ERC20(Ethereum Request for Comment 20) ì´ë€**, ì´ë”ë¦¬ì›€ ì»¤ë®¤ë‹ˆí‹°ì˜ Ethereum Request for Commentë¼ëŠ” ê²Œì‹œíŒì˜ 20ë²ˆì§¸ ê¸€ì„ ì¤„ì—¬ì„œ í‘œí˜„í•œ ê²ƒì´ë‹¤.
ì´ë”ë¦¬ì›€ì˜ ì°½ì‹œì ë¹„íƒˆë¦­ ë¶€í…Œë¦°(Vitalik Buterin)ì´ ì œì•ˆí•œ í‘œì¤€ í† í° ìŠ¤í™ìœ¼ë¡œ ë””ì•±ì—ì„œ ì‚¬ìš©ë˜ëŠ” ETHë¥¼ ì œì™¸í•œ ë””ì§€í„¸ ìì‚°ì´ë‹¤. í˜„ê¸ˆê³¼ ê°™ì´ 1:1ì˜ êµí™˜ì´ ê°€ëŠ¥í•œ ê°€ì¹˜ë¥¼ ì§€ë‹ˆê³  ìˆë‹¤.(1$ì™€ 1$ëŠ” ê°™ì€ ê°€ì¹˜ë¥¼ ì§€ë‹ˆê³  ìˆê¸° ë•Œë¬¸ì— ì˜ë¯¸ëŠ” ì—†ì§€ë§Œ êµí™˜ì´ ê°€ëŠ¥í•˜ë‹¤.)

</aside>

## ERC721 í‘œì¤€, ë‚´ ìƒí’ˆ í™•ì¸í•˜ê¸°

`ProductFactory` ì»¨íŠ¸ë™íŠ¸ëŠ” ì´ë”ë¦¬ì›€ í‘œì¤€ í† í° ì¤‘ ERC721ê³¼ ìƒë‹¹íˆ ìœ ì‚¬í•˜ë‹¤. ERC721 ì´ë€, ì¦ì„œë¼ê³  ì•Œë ¤ì§„ ëŒ€ì²´ë¶ˆê°€í† í°(NFT, Non Fungible Token) í‘œì¤€ì•ˆìœ¼ë¡œ ë°œí–‰ëœ í† í°ë“¤ì€ ì„œë¡œ ëŒ€ì²´ê°€ ë¶ˆê°€ëŠ¥í•˜ê¸° ë–„ë¬¸ì— ê°ê°ì˜ ê°€ì¹˜ë¥¼ ì§€ë‹Œë‹¤. ìš°ë¦¬ê°€ ì˜¬ë¦´ ìƒí’ˆë“¤ ë˜í•œ ê°ê°ì˜ ê°€ì¹˜ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ERC721 í‘œì¤€ì— ë§ì¶° ê°ê°ì˜ ê¸°ëŠ¥ë“¤ì„ êµ¬í˜„í•´ ë³´ê² ë‹¤.

ìš°ì„  ìš°ë¦¬ì˜ `ProductFactory` ì»¨íŠ¸ë™íŠ¸ëŠ” ì•„ì§ ìƒí’ˆì˜ ì£¼ì¸ì´ ëˆ„êµ¬ì¸ì§€ ëª¨ë¥¸ë‹¤. ë•Œë¬¸ì— ìƒí’ˆì˜ ì£¼ì¸ì„ í™•ì¸í•  ìˆ˜ ìˆê²Œ ERC721ì˜ í‘œì¤€ í•¨ìˆ˜ì¸ `balanceOf` `ownerOf` í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë³´ê² ë‹¤.

- **balanceOf**: ì†Œìœ ìì˜ ìì‚°(í† í°)ì˜ ë³´ìœ  ê°¯ìˆ˜ë¥¼ ë°˜í™˜
- **ownerOf**: ì§€ì •í•œ í† í°ì˜ ì†Œìœ ìë¥¼ ë°˜í™˜

```solidity
// ì™¸ë¶€ í˜¸ì¶œ í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— externalë¡œ ì„¤ì •, ìŠ¤í† ë¦¬ì§€ ë³€ê²½ì´ ì—†ê¸° ë•Œë¬¸ì— view í•¨ìˆ˜ì´ë‹¤
function balanceOf(address _owner) external view returns (uint256) {
	// ì†Œìœ í•œ ìì‚°ì˜ ê°¯ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤
}
function ownerOf(uint256 _id) external view returns (address) {
		// í† í°ì˜ ì†Œìœ ì ì£¼ì†Œë¥¼ ë°˜í™˜í•œë‹¤
}
```

<aside>
ğŸ’¡ [Openzeppelinì—ì„œ ì œê³µí•˜ëŠ” ERC721 í‘œì¤€ ìŠ¤í™](https://docs.openzeppelin.com/contracts/2.x/api/token/erc721#IERC721)ì´ë‹¤. Openzeppelinì€ ERC20, ERC777ê³¼ ê°™ì€ í† í° ìŠ¤í™ì„ êµ¬í˜„í•œ ì»¨íŠ¸ë™íŠ¸ë“¤ì„ ì˜¤í”ˆì†ŒìŠ¤ë¡œ ì œê³µí•˜ê³  ìˆë‹¤. ë§ì€ ì‚¬ëŒë“¤ì´ ì‚¬ìš©ì¤‘ì´ê³  ê²€ì¦ëœ ì˜¤í”ˆì†ŒìŠ¤ì´ê¸° ë•Œë¬¸ì— í‘œì¤€ ìŠ¤í™ì„ êµ¬í˜„í•˜ëŠ”ë° ë§ì´ ì‚¬ìš©ëœë‹¤.

</aside>

### ë§¤í•‘ê³¼ ì£¼ì†Œ, ì†Œìœ ì ì£¼ì†Œ ì €ì¥í•˜ê¸°

í•¨ìˆ˜ë¥¼ ë§Œë“¤ê¸° ì „ì— ìƒí’ˆ ì†Œìœ ìì™€ ì†Œìœ í•œ ìƒí’ˆì˜ ê°¯ìˆ˜ë¥¼ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•  í•„ìš”ê°€ ìˆë‹¤. ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„í•´ë³¼ ì˜ˆì •ì´ë‹¤.

- ì†Œìœ ì = ì†Œìœ í•œ ìƒí’ˆ ê°¯ìˆ˜
- ìƒí’ˆ = ì†Œìœ ì

ì´ëŸ¬í•œ ê·¸ë£¹ì„ ë¬¶ì–´ êµ¬ì¡°í™”ëœ í˜•íƒœë¡œ ì €ì¥í•˜ëŠ” ë°©ì‹ì„ ì†”ë¦¬ë””í‹°ì—ì„œ **ë§¤í•‘(mapping)** ì´ë¼ê³  í•œë‹¤. ë§¤í•‘ì€ ê¸°ë³¸ì ìœ¼ë¡œ í‚¤ì™€ ê°’(key=value) í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê²€ìƒ‰ì—ëŠ” key ê°’ì´ ì‚¬ìš©ëœë‹¤. ì´ë•Œ ì†Œìœ ìì˜ ê³ ìœ í•œ ê°’ì´ **ì£¼ì†Œ(address)**ë¥¼ ì´ìš©í•´ë³´ë¡ í•˜ê² ë‹¤. ì£¼ì†Œ ë˜í•œ ì†”ë¦¬ë””í‹°ì˜ íƒ€ì… ì¤‘ í•˜ë‚˜ë¡œ ì´ë”ë¦¬ì›€ì˜ ì£¼ì†Œë¥¼ ë‚˜íƒ€ë‚´ëŠ” íƒ€ì…ì´ë‹¤.

`ProductFactory` ì»¨íŠ¸ë™íŠ¸ì— ë‹¤ìŒ ë§¤í•‘ì„ ì¶”ê°€í•œë‹¤.

```solidity
// ì†Œìœ ì ì£¼ì†Œ => ì†Œìœ í•œ ìƒí’ˆ ê°¯ìˆ˜, ì†Œìœ ì ì£¼ì†Œë¥¼ ì¡°íšŒí•˜ì—¬ ê°¯ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤.
mapping(address => uint256) public ownerProductCount;
// ìƒí’ˆ => ì†Œìœ ì ì£¼ì†Œ, ìƒí’ˆID ê°’ìœ¼ë¡œ ì¡°íšŒí•˜ì—¬ ì†Œìœ ì ì£¼ì†Œë¥¼ ë°˜í™˜í•œë‹¤.
mapping(uint256 => address) public productToOwner;
```

### ìƒì†, ì†Œìœ (Ownership) ì»¨íŠ¸ë™íŠ¸ ìƒì„±í•˜ì—¬ ë¡œì§ ë¶„ë¦¬í•˜ê¸°

ìƒì†ì„ ì´ìš©í•˜ì—¬ ë¡œì§ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤. ERC721 í‘œì¤€ ìŠ¤í™ìœ¼ë¡œ í† í°ì„ ì „ì†¡(ì†Œìœ ê¶Œ ì´ì „)í•˜ëŠ” í•¨ìˆ˜ë“¤ì´ ìˆë‹¤. ì´ëŸ° í•¨ìˆ˜ë“¤ì„ `ProductFactory` ì»¨íŠ¸ë™íŠ¸ì— ëª¨ë‘ ì‘ì„±í•˜ë©´ ì½”ë“œê°€ ê¸¸ì–´ì ¸ ê°œë°œí•˜ëŠ”ë° ê°€ë…ì„±ì´ ì¢‹ì§€ ì•Šë‹¤.

`ProductOwnership` ì»¨íŠ¸ë™íŠ¸ íŒŒì¼ì„ ìƒì„±í•œ í›„ `ProductFactory` ì»¨íŠ¸ë™íŠ¸ íŒŒì¼ì„ import êµ¬ë¬¸ìœ¼ë¡œ ê°€ì ¸ì˜¨ë‹¤.

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

// ProductFactoryì˜ ëª¨ë“  ì»¨íŠ¸ë™íŠ¸ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
import './ProductFactory.sol';

contract ProductOwnership {
}
```

import êµ¬ë¬¸ìœ¼ë¡œ í•´ë‹¹ ì†”ë¦¬ë””í‹° íŒŒì¼ì— ëª¨ë“  ì»¨íŠ¸ë™íŠ¸ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

ì´í›„ `ProductOwnership` ì»¨íŠ¸ë™íŠ¸ì— is ë¬¸ë²•ìœ¼ë¡œ `ProductFactory` ì»¨íŠ¸ë™íŠ¸ë¥¼ ìƒì†í•  ìˆ˜ ìˆë‹¤. ìƒì†ë°›ì€ ì»¨íŠ¸ë™íŠ¸ëŠ” ìƒì† ì»¨íŠ¸ë™íŠ¸ì— ìƒíƒœ ë³€ìˆ˜ì™€ ë©”ì„œë“œë¥¼ ì‚¬ìš©(internalê³¼ publicìœ¼ë¡œ ì„ ì–¸ëœ)í•  ìˆ˜ ìˆë‹¤.

balanceOfì™€ ownerOfë¥¼ ì¶”ê°€í•œ í›„ ìƒì†ë°›ì€ `ProductFactory` ì»¨íŠ¸ë™íŠ¸ì˜ ìƒíƒœ ë³€ìˆ˜ì¸ ownerProductCountì™€ ProductToOwnerë¥¼ ì¶”ê°€í•œë‹¤.(ê°ê°ì˜ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ëŠ”ë° ì‚¬ìš©)

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import './ProductFactory.sol';

contract ProductOwnership is ProductFactory {
	// ProductFactoryë¥¼ ìƒì†ë°›ì•„ internal or publicìœ¼ë¡œ ì„ ì–¸ëœ ëª¨ë“  ìƒíƒœë³€ìˆ˜ì™€ ë©”ì„œë“œë¥¼ ì‚¬ìš©

	/**
   * @dev í† í° ì†Œìœ ëŸ‰ ê°€ì ¸ì˜¤ê¸°
   */
  function balanceOf(address _owner) public view virtual returns (uint256) {
		// ownerProductCount ìƒíƒœë³€ìˆ˜ëŠ” í•´ë‹¹ ì£¼ì†Œê°€ ì†Œìœ í•œ í† í°ì˜ ì´ ìˆ˜ëŸ‰ì„ ë‚˜íƒ€ëƒ„
    return ownerProductCount[_owner];
  }

  /**
   * @dev í† í° ì†Œìœ ì ê°€ì ¸ì˜¤ê¸°
   */
  function ownerOf(uint256 _tokenId) public view returns (address) {
		// productToOwner ìƒíƒœë³€ìˆ˜ëŠ” í•´ë‹¹ í† í°ì˜ ì†Œìœ ì ì£¼ì†Œë¥¼ ë‚˜íƒ€ëƒ„
    return productToOwner[_tokenId];
  }
}
```

### Transfer, ì†Œìœ ì ì´ì „í•˜ê¸°

ERC721 ìŠ¤í™ìœ¼ë¡œ í•œ ê³„ì •ì— í† í°ì„ ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ì†Œìœ ì ì´ì „í•˜ëŠ” transferFrom ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ë³´ì. ì‹¤ì§ˆì ìœ¼ë¡œ ê³„ì •ì— í† í°ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì»¨íŠ¸ë™íŠ¸ ë¡œì§ì—ì„œ íŠ¹ì • í† í°ì´ ê³„ì •ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ê³  ìˆëŠ” ê²ƒì´ë‹¤.(ë¸”ë¡ì²´ì¸ ìƒì—ì„œ íŠ¸ëœì­ì…˜ì´ë¼ëŠ” í˜•íƒœë¡œ ì €ì¥ë˜ì–´ ìˆìŒ) ë•Œë¬¸ì— transferFrom ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì€ ì‰½ë‹¤.

```solidity
function transferFrom(
    address _from,
    address _to,
    uint256 _tokenId
  ) private {
    ownerProductCount[_from]--;
    ownerProductCount[_to]++;

    productToOwner[_tokenId] = _to;

    emit Transfer(_from, _to, _tokenId);
  }
```

í•˜ì§€ë§Œ ì´ëŸ°ì‹ìœ¼ë¡œ êµ¬í˜„í•œë‹¤ë©´ ëˆ„êµ¬ë‚˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê³  ë³´ì•ˆì— ë§¤ìš° ì·¨ì•½í•˜ë‹¤. ë•Œë¬¸ì— ERC721ì—ì„œëŠ” í•´ë‹¹ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ì „ ì†Œìœ ì ìŠ¹ì¸ ë¡œì§ì´ í•„ìš”í•˜ë‹¤ê³  í•œë‹¤. ì´ ì†Œìœ ì ìŠ¹ì¸ì„ ì²˜ë¦¬í•˜ëŠ” ë©”ì„œë“œë¥¼ approveë¼ê³  í•œë‹¤.

approve ë©”ì„œë“œëŠ” ì˜¤ì§ í† í° ì†Œìœ ìë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤. ë•Œë¬¸ì— ê±°ë˜ëŠ” ì†Œìœ ì ìŠ¹ì¸ í›„ êµ¬ë§¤ì ë˜ëŠ” ì†Œìœ ìê°€ transferFrom í˜¸ì¶œì„ í†µí•´ ê±°ë˜ê°€ ì„±ì‚¬ëœë‹¤.

requireëŠ” ì¡°ê±´ì´ ì°¸ í˜¹ì€ ê±°ì§“ì¸ì§€ í™•ì¸í•˜ê³  ì°¸ì¼ ê²½ìš°ë§Œ ì½”ë“œ íë¦„ì„ í—ˆìš©í•œë‹¤. ê±°ì§“ì¼ ê²½ìš° ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ì‹¤í–‰ë˜ì§€ ì•Šê³  íŠ¸ëœì­ì…˜ì€ ì·¨ì†Œ(revert)ëœë‹¤. ë•Œë¬¸ì— ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì€ ê°’ì„ í™•ì¸í•˜ê¸° ìœ„í•´ ë§ì´ ì‚¬ìš©ëœë‹¤.

```solidity
// í† í° ì†Œìœ ìê°€ ìŠ¹ì¸í•œ ê³„ì •ë“¤ì´ ì €ì¥ëœë‹¤.
mapping(uint256 => address) private _approvals;

function approve(address _to, uint256 _tokenId) public {
  address owner = this.ownerOf(_tokenId);

	// ìŠ¹ì¸í•  ê³„ì •ì´ ì†Œìœ ìì¼ ê²½ìš° ì·¨ì†Œ
	// ê±°ì§“ì¼ ê²½ìš° ë‘ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì€ ì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ EVMì— ë°˜í™˜í•œë‹¤.
  require(_to != owner, 'Approval to current owner');
	// í˜¸ì¶œìê°€ í•´ë‹¹ í† í° ì†Œìœ ì ë§ëŠ”ì§€ í™•ì¸
  require(
    msg.sender == owner,
    'Approve caller is not owner nor approved for all'
  );

	// ìƒíƒœë³€ìˆ˜ì— ì €ì¥
  _approve(_to, _tokenId);
}

/**
 * @dev í† í° ìŠ¹ì¸
 */
function _approve(address _to, uint256 _tokenId) private {
  _approvals[_tokenId] = _to;

  emit Approval(this.ownerOf(_tokenId), _to, _tokenId);
}
```

ë§ˆì§€ë§‰ìœ¼ë¡œ transferFrom ë©”ì„œë“œì— í•´ë‹¹ í† í°ì´ ì†Œìœ ì ìŠ¹ì¸ì„ ë°›ì€ í† í°ì¸ì§€ í™•ì¸í•˜ëŠ” ë¡œì§ë§Œ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤. (transferFromì€ ìŠ¹ì¸ ë°›ì§€ ì•Šì€ í† í°ì´ì—¬ë„ ì†Œìœ ìëŠ” í˜¸ì¶œì´ ê°€ëŠ¥í•˜ë‹¤.)

```solidity
function transferFrom(
  address _from,
  address _to,
  uint256 _tokenId
) external {
  require(
		// ìŠ¹ì¸ ë°›ì€ êµ¬ë§¤ì ë˜ëŠ” ì†Œìœ ì ì¸ì§€ í™•ì¸
		// ì†Œìœ ìëŠ” í•´ë‹¹ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.
    _isApprovedOrOwner(msg.sender, _tokenId),
    'Transfer caller is not owner nor approved'
  );

  _transfer(_from, _to, _tokenId);
}

/**
 * @dev í† í° ì†Œìœ ì ë˜ëŠ” ê²°ì œì ìŠ¹ì¸ ì—¬ë¶€ ë°˜í™˜
 */
function _isApprovedOrOwner(address _spender, uint256 _tokenId)
  internal
  view
  returns (bool)
{
  address owner = this.ownerOf(_tokenId);

  return (_spender == owner || getApproved(_tokenId) == _spender);
}

/**
 * @dev ìŠ¹ì¸ ì—¬ë¶€ ê°€ì ¸ì˜¤ê¸°
 */
function getApproved(uint256 _tokenId) public view returns (address) {
  require(_exists(_tokenId), 'Operator query for nonexistent token');

  return _approvals[_tokenId];
}
/**
 * @dev í† í°IDì˜ ì†Œìœ ì ì—¬ë¶€ ë°˜í™˜
 */
function _exists(uint256 _tokenId) internal view returns (bool) {
  return productToOwner[_tokenId] != address(0);
}
```

### ìµœì¢…ì½”ë“œ

- í† í° ì „ì†¡ê³¼ ìŠ¹ì¸ì— ë”°ë¥¸ ì´ë²¤íŠ¸ ì¶”ê°€
- ì½”ë“œ ì¬ì‚¬ìš©ì„ ìœ„í•´ ë¡œì§ ë¶„ë¦¬
- ë°ì´í„° ì €ì¥ ë¡œì§ ë¶„ë¦¬

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import './ProductFactory.sol';

contract ProductOwnership is ProductFactory {
  event Transfer(address from, address to, uint256 tokenId);
  event Approval(address productToOwner, address to, uint256 tokenId);

  mapping(uint256 => address) private _approvals;

  /**
   * @dev í† í° ì†Œìœ ëŸ‰ ê°€ì ¸ì˜¤ê¸°
   */
  function balanceOf(address _owner) public view virtual returns (uint256) {
    return ownerProductCount[_owner];
  }

  /**
   * @dev í† í° ì†Œìœ ì ê°€ì ¸ì˜¤ê¸°
   */
  function ownerOf(uint256 _tokenId) public view returns (address) {
    return productToOwner[_tokenId];
  }

  /**
   * @dev ì†Œìœ ì ë˜ëŠ” ìŠ¹ì¸ ì—¬ë¶€ì— ë”°ë¥¸ í† í° ì „ì†¡
   */
  function transferFrom(
    address _from,
    address _to,
    uint256 _tokenId
  ) external {
    require(
      _isApprovedOrOwner(msg.sender, _tokenId),
      'Transfer caller is not owner nor approved'
    );

    _transfer(_from, _to, _tokenId);
  }

  /**
   * @dev ì†Œìœ ìê°€ í† í° ìŠ¹ì¸í•˜ê¸°
   */
  function approve(address _to, uint256 _tokenId) public {
    address owner = this.ownerOf(_tokenId);

    require(_to != owner, 'Approval to current owner');
    require(
      msg.sender == owner,
      'Approve caller is not owner nor approved for all'
    );

    _approve(_to, _tokenId);
  }

  /**
   * @dev ìŠ¹ì¸ ì—¬ë¶€ ê°€ì ¸ì˜¤ê¸°
   */
  function getApproved(uint256 _tokenId) public view returns (address) {
    require(_exists(_tokenId), 'Operator query for nonexistent token');

    return _approvals[_tokenId];
  }

  /**
   * @dev í† í° ì „ì†¡
   */
  function _transfer(
    address _from,
    address _to,
    uint256 _tokenId
  ) private {
    ownerProductCount[_from]--;
    ownerProductCount[_to]++;

    productToOwner[_tokenId] = _to;

    emit Transfer(_from, _to, _tokenId);
  }

  /**
   * @dev í† í° ìŠ¹ì¸
   */
  function _approve(address _to, uint256 _tokenId) private {
    _approvals[_tokenId] = _to;

    emit Approval(this.ownerOf(_tokenId), _to, _tokenId);
  }

  /**
   * @dev í† í° ì†Œìœ ì ë˜ëŠ” ê²°ì œì ìŠ¹ì¸ ì—¬ë¶€ ë°˜í™˜
   */
  function _isApprovedOrOwner(address _spender, uint256 _tokenId)
    internal
    view
    returns (bool)
  {
    address owner = this.ownerOf(_tokenId);

    return (_spender == owner || getApproved(_tokenId) == _spender);
  }

  /**
   * @dev í† í°IDì˜ ì†Œìœ ì ì—¬ë¶€ ë°˜í™˜
   */
  function _exists(uint256 _tokenId) internal view returns (bool) {
    return productToOwner[_tokenId] != address(0);
  }
}
```

<aside>
â“ **_transfer, _approveì™€ ê°™ì€ private ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ëŠ” ì´ìœ **
ì½”ë“œ ì¬ì‚¬ìš©ì„ ìœ„í•´ì„œë„ ìˆì§€ë§Œ, ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ì˜ íŠ¹ì„±ì¸ ë¶ˆë³€ì„±ì˜ ë³´ì•ˆ ì´ìŠˆë¥¼ ìœ„í•´ ì§ì ‘ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë¡œì§ì€ í•´ë‹¹ ì»¨íŠ¸ë™íŠ¸ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ privateìœ¼ë¡œ ì„ ì–¸í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.(ì–¸ë”ìŠ¤ì½”ì–´ëŠ” í•¨ìˆ˜ ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©í•œë‹¤ëŠ” ì•”ë¬µì  ì˜ë¯¸ì´ê¸°ë„ í•˜ê¸° ë•Œë¬¸ì— ê°€ë…ì„± ë˜í•œ ì¢‹ì•„ì§„ë‹¤.)

</aside>

### í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

```solidity
const { expect } = require('chai');
const { ethers } = require('hardhat');

describe('ProductOwnership', async function () {
  let owner, user, spender;
  let productOwnership;
  let newProductEvents = [],
    newProductId;

  const product = [
    'MacBook-pro M1X 16inch',
    'apple',
    'MacBook-pro M1X 16inch, Space Gray, 64GB Memory, 8TB SSD Storage, Pre-Installed "Final Cut Pro" and "Logic Pro"',
    'https://store.storeimages.cdn-apple.com/8756/as-images.apple.com/is/mbp16-spacegray-gallery2-202110?wid=4000&hei=3072&fmt=jpeg&qlt=80&.v=1632799174000',
  ];

  before(async function () {
    const [ownerSigner, addrSigner, addr2Signer] = await ethers.getSigners();
    owner = ownerSigner;
    user = addrSigner;
    spender = addr2Signer;

    const Ownership = await ethers.getContractFactory('ProductOwnership');
    const ownership = await Ownership.deploy();

    await ownership.deployed();

    productOwnership = ownership;
  });

  it('#1 ìƒí’ˆ ìƒì„±í•˜ê¸°', async function () {
    const createProduct = await productOwnership
      .connect(user)
      .createProduct(...product);

    const receipt = await createProduct.wait();

    const events = receipt.events.filter((x) => {
      return x.event == 'NewProduct';
    });
    newProductEvents = events;

    expect(events).to.not.length(0);
  });

  it('#2 ì¶”ê°€ëœ ìƒí’ˆ ì¡°íšŒí•˜ê¸°', async function () {
    const lastEvent = newProductEvents.pop();
    const productId = lastEvent.args.id.toNumber();
    newProductId = productId;

    const [...hot] = await productOwnership.getProduct(productId);

    expect(hot).deep.to.equal(product);
  });

  it('#3 Ownable ì²´í¬', async function () {
    const balanceOf = await productOwnership.balanceOf(user.address);
    const ownerOf = await productOwnership.ownerOf(newProductId);

    expect(balanceOf.toNumber()).to.equal(1);
    expect(ownerOf).to.equal(user.address);
  });

  it('#4 í† í° ìŠ¹ì¸', async function () {
    await productOwnership.connect(user).approve(spender.address, newProductId);

    const approved = await productOwnership.getApproved(newProductId);

    expect(approved).to.equal(spender.address);
  });

  it('#5 ìŠ¹ì¸ í† í° ì „ì†¡', async function () {
    await productOwnership.connect(user).transferFrom(
      user.address,
      spender.address,
      newProductId,
    );

    const productToOwner = await productOwnership.ownerOf(newProductId);
    expect(productToOwner).to.equal(spender.address);
  });
});
```

# ì—ìŠ¤í¬ë¡œ(Escrow) ìŠ¤ë§ˆíŠ¸ ê³„ì•½

---

[How to implement an ERC-721 market | ethereum.org](https://ethereum.org/en/developers/tutorials/how-to-implement-an-erc721-market/)

ì´ë”ë¦¬ì›€ ê³µì‹ ì‚¬ì´íŠ¸ì—ì„œ ì œì‹œí•˜ëŠ” ERC721 íŒë§¤ì‹œì¥ êµ¬ì¶• ë°©ë²•

ì—ìŠ¤í¬ë¡œ ì»¨íŠ¸ë™íŠ¸ëŠ” ìƒì„±ëœ ìƒí’ˆì„ íŒë§¤í•˜ê³ , êµ¬ë§¤ìê°€ í™•ì¸í•˜ì—¬ ìµœì¢…ì ìœ¼ë¡œ íŒë§¤ìì—ê²Œ ì´ë”(Ether)ë¥¼ ì „ì†¡í•˜ëŠ” ê¸°ëŠ¥ì„ ë‹´ë‹¹í•œë‹¤.

### ì—ìŠ¤í¬ë¡œ ì»¨íŠ¸ë™íŠ¸ ê¸°ëŠ¥

- ë“±ë¡(openTrade): ìƒì„±ëœ ìƒí’ˆì˜ í† í°ê³¼ íŒë§¤ ê¸ˆì•¡ì„ ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì— ì €ì¥
- êµ¬ë§¤(executeTrade): ìƒì„±ëœ ê±°ë˜ì— ì´ë”ë¥¼ ë³´ë‚´ê³  êµ¬ë§¤ìì˜ ì£¼ì†Œë¥¼ ë§¤í•‘(mapping)ì— ì €ì¥
- í™•ì¸(confirmTrade): êµ¬ë§¤ ì²˜ë¦¬ëœ ê±°ë˜ë¥¼ êµ¬ë§¤ìê°€ ìµœì¢…ì ìœ¼ë¡œ í™•ì¸í•˜ì—¬ ì´ë”ë¥¼ íŒë§¤ìì—ê²Œ ì „ì†¡
- íŒŒê¸°(breakTrade): êµ¬ë§¤ì²˜ë¦¬ëœ ê±°ë˜ë¥¼ êµ¬ë§¤ìê°€ íŒŒê¸°í•˜ì—¬ ì»¨íŠ¸ë™íŠ¸ê°€ êµ¬ë§¤ìì—ê²Œ ì´ë”ë¥¼ ì „ì†¡
- íŒŒê¸° ìŠ¹ì¸(approveBreak): ê±°ë˜ íŒŒê¸° ì „ íŒë§¤ì ë˜ëŠ” ì»¨íŠ¸ë™íŠ¸ ì†Œìœ ìê°€ ìŠ¹ì¸ì„ ì§„í–‰
- ì·¨ì†Œ(cancelTrade): íŒë§¤ìê°€ ê±°ë˜ë¥¼ ì·¨ì†Œ

<aside>
ğŸ’¡ ì—ìŠ¤í¬ë¡œëŠ” ì‚¬ê¸°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì…ê¸ˆëœ ê±°ë˜ ëŒ€ê¸ˆì„ ê´€ë¦¬í•˜ê³ , êµ¬ë§¤ìì˜ ìŠ¹ì¸í•˜ì—  íŒë§¤ìì—ê²Œ ê±°ë˜ ëŒ€ê¸ˆì„ ì§€ë¶ˆí•œë‹¤. ì¦‰, ì œ 3ìì˜ ê³„ì…ì„ í†µí•´ ì‚¬ê¸°ë¥¼ ë°©ì§€í•œë‹¤.

</aside>

## ê±°ë˜ ë“±ë¡

ìš°ë¦¬ê°€ êµ¬í˜„í•œ `ProductOwnership` ê³¼ `ProductFactory` ì»¨íŠ¸ë™íŠ¸ëŠ” ERC721ì˜ í˜•íƒœì™€ ìƒë‹¹íˆ ìœ ì‚¬í•˜ë‹¤. ê°ê¸° ë‹¤ë¥¸ ìƒí’ˆì´ ê³ ìœ í•œ ê°€ì¹˜ë¥¼ ì§€ë‹ˆê³  ìˆëŠ”ë° ì´ë¥¼ ERC721ì—ì„œëŠ” **ëŒ€ì²´ë¶ˆê°€í† í°(NFT, Non-Fungible Token)**ì´ë¼ê³  ë¶€ë¥¸ë‹¤.

ì´ëŸ° ìƒí’ˆ(ì´í•˜ í† í°)ë“¤ì˜ ID ê°’ê³¼ íŒë§¤ì ì£¼ì†Œ, ê±°ë˜ ê¸ˆì•¡, ìƒíƒœê°’ì„ ì €ì¥í•œë‹¤.

```solidity
contract Escrow {
	// ì•„ë˜ë¶€í„° íŒë§¤ìì£¼ì†Œ, í† í°ID, ê±°ë˜ê¸ˆì•¡, ìƒíƒœë¥¼ êµ¬ì¡°ì²´(strcut)ë¡œ ì •ì˜
	struct Trade {
    address poster;
    uint256 tokenId;
    uint256 amount;
    bytes32 status; // open, executed, confirmed, cancelled
  }

	// ë§¤í•‘í•˜ì—¬ ì—¬ëŸ¬ ê°’ì„ ìƒíƒœë³€ìˆ˜ë¡œ ì €ì¥
	mapping(uint256 => Trade) public trades;
}
```

ê±°ë˜ ìƒì„± ë©”ì„œë“œë¥¼ í†µí•´ ì‚¬ìš©ìê°€ íŒë§¤í•  ìƒí’ˆê³¼ ê±°ë˜ ëŒ€ê¸ˆì„ ì´ë”ë¦¬ì›€ì— ì €ì¥í•œë‹¤. ìƒí’ˆì€ ì¶”í›„ êµ¬ë§¤ìì—ê²Œ ì†Œìœ ê¶Œì„ ë„˜ê¸°ê¸°ìœ„í•´ ì—ìŠ¤í¬ë¡œ ì»¨íŠ¸ë™íŠ¸ì— í† í°ì„ ì „ì†¡í•œë‹¤.

```solidity
	/**
   * @dev ê±°ë˜ ìƒì„±
   */
  function openTrade(uint256 _tokenId, uint256 _amount) external {
		// ì»¨íŠ¸ë™íŠ¸ì—ì„œ ë‹¤ë¥¸ ì»¨íŠ¸ë™íŠ¸ ë©”ì„œë“œ í˜¸ì¶œí•˜ê¸°
    product.transferFrom(msg.sender, address(this), _tokenId);

    uint256 tradeId = tradeCounter;

    trades[tradeId] = Trade({
      poster: msg.sender,
      tokenId: _tokenId,
      amount: _amount,
      status: 'open'
    });

    tradeCounter++;

    emit TradeStatusChange(tradeId, 'open');
  }
```

### ìƒí’ˆ ì „ì†¡, ì„œë¡œë‹¤ë¥¸ ì»¨íŠ¸ë™íŠ¸ ìƒí˜¸ì‘ìš©í•˜ê¸°

ì†”ë¦¬ë””í‹°ì—ì„œëŠ” ì¸í„°í˜ì´ìŠ¤(interface)ë¥¼ êµ¬í˜„í•˜ì—¬ ì„œë¡œë‹¤ë¥¸ ì»¨íŠ¸ë™íŠ¸ì™€ ìƒí˜¸ì‘ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

```solidity
// ì»¨íŠ¸ë™íŠ¸ì—ì„œ ë‹¤ë¥¸ ì»¨íŠ¸ë™íŠ¸ ë©”ì„œë“œ í˜¸ì¶œí•˜ê¸°
product.transferFrom(msg.sender, address(this), _tokenId);
```

ì´ ì½”ë“œëŠ” ìš°ë¦¬ê°€ êµ¬í˜„í•œ `ProductOwnership` ì»¨íŠ¸ë™íŠ¸ì˜ transferFrom ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œì´ë‹¤. ì¸í„°í˜ì´ìŠ¤ëŠ” ì»¨íŠ¸ë™íŠ¸ì™€ ìƒí˜¸ì‘ìš©í•  ë©”ì„œë“œë§Œ ì„ ì–¸í•œë‹¤.

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

interface IProductOwnership {
  event Transfer(
    address indexed from,
    address indexed to,
    uint256 indexed tokenId
  );
  event Approval(
    address indexed productToOwner,
    address indexed to,
    uint256 indexed tokenId
  );

  function balanceOf(address _owner) external view returns (uint256);

  function ownerOf(uint256 _tokenId) external view returns (address);

	// ì‚¬ìš©í•  í•¨ìˆ˜ ì„ ì–¸
	// í˜¸ì¶œí•  í•¨ìˆ˜ì˜ ì •ë³´ê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— í•´ë‹¹ í•¨ìˆ˜ì˜ ì„ ì–¸ê³¼ ì •í™•íˆ ë§ì•„ì•¼ í•œë‹¤.
  function transferFrom(
    address _from,
    address _to,
    uint256 _tokenId
  ) external;

  function approve(address _to, uint256 _tokenId) external;

  function getApproved(uint256 _tokenId) external view returns (address);
}
```

í˜¸ì¶œì„ ìœ„í•´ ìƒíƒœ ë³€ìˆ˜ë¡œ ì„ ì–¸í•œ í›„ ìƒì„±ì í•¨ìˆ˜ë¡œ ì´ˆê¸°í™”í•œë‹¤. ì¸í„°í˜ì´ìŠ¤ëŠ” í˜¸ì¶œí•  ì»¨íŠ¸ë™íŠ¸ì˜ ì£¼ì†Œë¥¼ ëŒ€ì…í•˜ì—¬ ì´ˆê¸°í™”í•œë‹¤.

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import './IProductOwnership.sol';

contract Escrow {
	// ì»¨íŠ¸ë™íŠ¸ ì†Œìœ ì ì£¼ì†Œ
	address private _owner;
  // ìƒíƒœ ë³€ìˆ˜ë¡œ ì„ ì–¸í•˜ì—¬ ì‚¬ìš©í•œë‹¤.
  IProductOwnership public product;

  // ìˆ˜ì •ì(modifier)ëŠ” ê¸°ì¡´ í•¨ìˆ˜ì˜ ë™ì‘ì„ ë³€ê²½í•œë‹¤.
  modifier onlyOwner() {
    require(_owner == msg.sender, 'Caller is not the owner');
    _;
  }

  constructor(address _productAddress) {
		// ì»¨íŠ¸ë™íŠ¸ ì†Œìœ ì ì„¤ì •
		_owner = msg.sender;
    // ë°°í¬ ì‹œ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œê°€ ì˜ëª»ë˜ê±°ë‚˜ ë³€ê²½ë˜ëŠ” ê²ƒì„ ì‚¬ì „ì— ë°©ì§€í•˜ê¸° ìœ„í•´
    // ì™¸ë¶€ ì ‘ê·¼ì´ ê°€ëŠ¥í•œ í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ ì£¼ì†Œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.
    setProductOwnership(_productAddress);
  }

  /**
   * @dev ProductOwnership ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ ë³€ê²½
   */
  function setProductOwnership(address _productAddress) public onlyOwner {
    // ì¸í„°í˜ì´ìŠ¤ì— í˜¸ì¶œí•  ì»¨íŠ¸ë™íŠ¸ì˜ ì£¼ì†Œë¥¼ ëŒ€ì…í•˜ì—¬ ì´ˆê¸°í™”í•œë‹¤.
    product = IProductOwnership(_productAddress);
  }
}
```

**ìˆ˜ì •ì(modifier)**ëŠ” ê¸°ì¡´ í•¨ìˆ˜ì˜ ë™ì‘ì„ ë³€ê²½ì‹œí‚¤ëŠ”ë° ì£¼ë¡œ í•¨ìˆ˜ ì‹¤í–‰ ì „ ì¡°ê±´ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤. ì´ëŸ° ì¡°ê±´ë“¤ê³¼ ê°™ì´ ë°˜ë³µë˜ëŠ” ë¡œì§ì— ëŒ€í•œ ê°€ë…ì„±ì„ ìœ„í•´ ì‚¬ìš©ëœë‹¤. ìˆ˜ì •ìëŠ” í•´ë‹¹ í•¨ìˆ˜ì˜ ì†ì„±ìœ¼ë¡œ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤. ì†ì„±ìœ¼ë¡œ ì„ ì–¸ëœ í•¨ìˆ˜ëŠ” í˜¸ì¶œ ì‹œ ìˆ˜ì •ìê°€ ì ìš©ë˜ëŠ”ë°, ìˆ˜ì •ìì—ì„œ ì½”ë“œê°€ ëë‚œ í›„ ì–¸ë”ë°”(_)ë¥¼ ì„ ì–¸í•˜ì—¬ í•´ë‹¹ í•¨ìˆ˜ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤.

ìƒì„±ì í•¨ìˆ˜ë¡œ **ì†Œìœ  ê°€ëŠ¥í•œ ì»¨íŠ¸ë™íŠ¸**ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ìœ„ì˜ ì½”ë“œì—ì„œ ownerë¼ëŠ” ìƒíƒœë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³  ë°°í¬ ì‹œ í˜¸ì¶œìì˜ ì£¼ì†Œë¥¼ ëŒ€ì…í•˜ë©´ í˜¸ì¶œìê°€ ì†Œìœ í•˜ê²Œë˜ëŠ” ì»¨íŠ¸ë™íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ìœ„ì˜ ì½”ë“œì—ì„œ onlyOnwerë¼ëŠ” ìˆ˜ì •ìë¡œ ì»¨íŠ¸ë™íŠ¸ ì†Œìœ ìë§Œ í˜¸ì¶œ ê°€ëŠ¥í•œ í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ë©´ ëœë‹¤.

<aside>
ğŸ’¡ ì»¨íŠ¸ë™íŠ¸ì— ì†Œìœ ìë¥¼ ì„¤ì •í•˜ëŠ” ì´ìœ ëŠ” ê´€ë¦¬ ê°€ëŠ¥í•œ ì»¨íŠ¸ë™íŠ¸ë¥¼ ë§Œë“¤ê¸° ìœ„í•¨ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ìœ„ì˜ `ProductOwnership` ì»¨íŠ¸ë™íŠ¸ë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” í•´ë‹¹ ì»¨íŠ¸ë™íŠ¸ì˜ ì£¼ì†Œê°€ í•„ìš”í•œë°, ì£¼ì†Œë¥¼ ì˜ëª» ì…ë ¥í•˜ê±°ë‚˜ í•´ë‹¹ ì»¨íŠ¸ë™íŠ¸ì˜ ë²„ê·¸ë¡œ ìƒˆë¡œìš´ ì»¨íŠ¸ë™íŠ¸ë¡œ ë°°í¬í•  ê²½ìš°(ì»¨íŠ¸ë™íŠ¸ëŠ” ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ìƒˆë¡œ ë°°í¬í•´ì•¼ ë¨) ì£¼ì†Œë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“  í›„ ì»¨íŠ¸ë™íŠ¸ ì†Œìœ ìë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ í•  ìˆ˜ ìˆë‹¤.

</aside>

## ì´ë”(Ether) ì§€ë¶ˆ, ìƒí’ˆ êµ¬ë§¤í•˜ê¸°

**payable** ì†ì„±ì„ ì´ìš©í•˜ì—¬ ìš”ì²­í•œ êµ¬ë§¤ìê°€ ì´ë”ë¥¼ ì»¨íŠ¸ë™íŠ¸ì— ë³´ë‚¼ ìˆ˜ ìˆë‹¤. payable ì†ì„±ì´ ì ìš©ëœ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ì´ë”ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìœ¼ë©°, í•¨ìˆ˜ ë‚´ë¶€ì ìœ¼ë¡œ ì´ë”ë¥¼ ë‹¤ë£° ìˆ˜ ìˆë‹¤. msg.valueëŠ” í˜¸ì¶œìê°€ ë³´ë‚¸ ì´ë”ì˜ ê±°ë˜ëŸ‰ì´ë‹¤.

```solidity
/**
 * @dev ê±°ë˜ êµ¬ë§¤
 * payable ì†ì„± ì‚¬ìš©
 */
function executeTrade(uint256 _tradeId) external payable {
  require(trades[_tradeId].status == 'open', 'Trade is not open');
	// ì „ì†¡í•œ ì´ë”ì™€ íŒë§¤ ìƒí’ˆ ê¸ˆì•¡ì´ ë§ëŠ”ì§€ ê²€ì‚¬
  require(
    trades[_tradeId].amount == msg.value,
    'Trade amount does not match.'
  );

  executedTradeToSpender[_tradeId] = msg.sender;
  trades[_tradeId].status = 'executed';

  emit TradeStatusChange(_tradeId, 'executed');
}
```

## ì´ë”(Ether) ì „ì†¡, ìƒí’ˆ í™•ì¸í•˜ê¸°

payable ë‚´ì¥ í•¨ìˆ˜ë¡œ íŠ¹ì • ì‚¬ìš©ìì—ê²Œ ì»¨íŠ¸ë™íŠ¸ê°€ ë³´ìœ í•œ ì´ë”ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.

```solidity
/**
 * @dev ê±°ë˜ í™•ì¸
 */
function confirmTrade(uint256 _tradeId) external {
  require(trades[_tradeId].status == 'executed', 'Trade is not excuted');
  require(msg.sender == trades[_tradeId].poster, 'Caller is not the poster');

  product.transferFrom(
    address(this),
    executedTradeToSpender[_tradeId],
    trades[_tradeId].tokenId
  );

	// payableë¡œ ì§€ì •ëœ ì‚¬ìš©ì ì£¼ì†Œë¡œ ì´ë”ë¥¼ ì „ì†¡(transfer)
  payable(trades[_tradeId].poster).transfer(trades[_tradeId].amount);

  trades[_tradeId].status = 'confirmed';

  emit TradeStatusChange(_tradeId, 'confirmed');
}
```

<aside>
ğŸ’¡ ì»¨íŠ¸ë™íŠ¸ ë˜í•œ ì‚¬ìš©ì ê³„ì •ì²˜ëŸ¼ ì£¼ì†Œë¥¼ ê°€ì§€ê³  ìˆë‹¤. ì´ëŠ” ì‚¬ìš©ì ê³„ì •ì²˜ëŸ¼ ì´ë”(Ether)ë¥¼ ì†Œìœ í•  ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤. **ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ(CA, Contract Address)**ëŠ” ì»¨íŠ¸ë™íŠ¸ í˜¸ì¶œì„ ìœ„í•´ ì‚¬ìš©ë˜ì§€ë§Œ, ì´ë”ë¥¼ ì „ì†¡í• ë•Œë„ ì‚¬ìš©ëœë‹¤.

</aside>

### ìµœì¢…ì½”ë“œ

```solidity
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import './IProductOwnership.sol';
import 'hardhat/console.sol';

contract Escrow {
  event TradeStatusChange(uint256 tradeId, string status);

  event BreakApproval(uint256 tradeId, address spender);

  event BreakTrade(uint256 tradeId);

  // ----------------------------------------------------------------------

  struct Trade {
    address poster;
    uint256 tokenId;
    uint256 amount;
    bytes32 status; // open, executed, confirmed, cancelled
  }

  address private _owner;

  IProductOwnership public product;

  mapping(uint256 => Trade) public trades;
  mapping(uint256 => address) public executedTradeToSpender;
  uint256 public tradeCounter;

  mapping(uint256 => address) private _breakApprovals;

  // ----------------------------------------------------------------------

  modifier onlyOwner() {
    require(_owner == msg.sender, 'Caller is not the owner');
    _;
  }

  // ----------------------------------------------------------------------

  constructor(address _productAddress) {
    _owner = msg.sender;
    tradeCounter = 0;
    setProductOwnership(_productAddress);
  }

  /**
   * @dev ê±°ë˜ ìƒì„±
   */
  function openTrade(uint256 _tokenId, uint256 _amount) external {
    product.transferFrom(msg.sender, address(this), _tokenId);

    uint256 tradeId = tradeCounter;

    trades[tradeId] = Trade({
      poster: msg.sender,
      tokenId: _tokenId,
      amount: _amount,
      status: 'open'
    });

    tradeCounter++;

    emit TradeStatusChange(tradeId, 'open');
  }

  /**
   * @dev ê±°ë˜ êµ¬ë§¤
   */
  function executeTrade(uint256 _tradeId) external payable {
    require(trades[_tradeId].status == 'open', 'Trade is not open');
    require(
      trades[_tradeId].amount == msg.value,
      'Trade amount does not match.'
    );

    executedTradeToSpender[_tradeId] = msg.sender;
    trades[_tradeId].status = 'executed';

    emit TradeStatusChange(_tradeId, 'executed');
  }

  /**
   * @dev ê±°ë˜ í™•ì¸
   */
  function confirmTrade(uint256 _tradeId) external {
    require(trades[_tradeId].status == 'executed', 'Trade is not excuted');
    require(msg.sender == trades[_tradeId].poster, 'Caller is not the poster');

    product.transferFrom(
      address(this),
      executedTradeToSpender[_tradeId],
      trades[_tradeId].tokenId
    );

    payable(trades[_tradeId].poster).transfer(trades[_tradeId].amount);

    trades[_tradeId].status = 'confirmed';

    emit TradeStatusChange(_tradeId, 'confirmed');
  }

  /**
   * @dev ê±°ë˜ íŒŒê¸°
   */
  function breakTrade(uint256 _tradeId) external {
    require(trades[_tradeId].status == 'executed', 'Trade is not excuted');
    require(
      msg.sender == executedTradeToSpender[_tradeId],
      'Caller is not the spender'
    );
    require(msg.sender == _breakApprovals[_tradeId], 'Caller is not approved');

    payable(executedTradeToSpender[_tradeId]).transfer(trades[_tradeId].amount);

    executedTradeToSpender[_tradeId] = address(0);
    trades[_tradeId].status = 'open';

    emit BreakTrade(_tradeId);
    emit TradeStatusChange(_tradeId, 'open');
  }

  /**
   * @dev ê±°ë˜ íŒŒê¸° ìŠ¹ì¸
   */
  function approveBreak(uint256 _tradeId, address _spender) public {
    require(
      msg.sender == _owner || msg.sender == trades[_tradeId].poster,
      'Caller is not the poster or owner'
    );

    _breakApprovals[_tradeId] = _spender;

    emit BreakApproval(_tradeId, _spender);
  }

  /**
   * @dev ê±°ë˜ ë“±ë¡ ì·¨ì†Œ
   */
  function cancelTrade(uint256 _tradeId) external {
    require(trades[_tradeId].status == 'open', 'Trade is not open');
    require(msg.sender == trades[_tradeId].poster, 'Caller is not the poster');

    product.transferFrom(address(this), msg.sender, trades[_tradeId].tokenId);

    trades[_tradeId].status = 'cancelled';

    emit TradeStatusChange(_tradeId, 'cancelled');
  }

  // ----------------------------------------------------------------------

  /**
   * @dev ProductOwnership ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ ë³€ê²½
   */
  function setProductOwnership(address _productAddress) public onlyOwner {
    product = IProductOwnership(_productAddress);
  }

  /**
   * @dev ì»¨íŠ¸ë™íŠ¸ ì†Œìœ ì ë³€ê²½
   */
  function changeOwner(address _newOwner) external onlyOwner {
    _owner = _newOwner;
  }
}
```

### í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

```jsx
const { expect } = require('chai');
const { ethers } = require('hardhat');
const { BigNumber } = require('ethers');

describe('Escrow', async function () {
  let owner, user, spender;
  let productOwnership, escrow;
  let newProductEvents = [],
    newProductId;

  const product = [
    'MacBook-pro M1X 16inch',
    'apple',
    'MacBook-pro M1X 16inch, Space Gray, 64GB Memory, 8TB SSD Storage, Pre-Installed "Final Cut Pro" and "Logic Pro"',
    'https://store.storeimages.cdn-apple.com/8756/as-images.apple.com/is/mbp16-spacegray-gallery2-202110?wid=4000&hei=3072&fmt=jpeg&qlt=80&.v=1632799174000',
  ];

  before(async function () {
    const [ownerSigner, addrSigner, addr2Signer] = await ethers.getSigners();
    owner = ownerSigner;
    user = addrSigner;
    spender = addr2Signer;

    // ProductOwnership ì»¨íŠ¸ë™íŠ¸ ë°°í¬
    const Ownership = await ethers.getContractFactory('ProductOwnership');
    const ownershipInstance = await Ownership.deploy();

    await ownershipInstance.deployed();

    productOwnership = ownershipInstance;

    // Escrow ì»¨íŠ¸ë™íŠ¸ ë°°í¬
    const Escrow = await ethers.getContractFactory('Escrow');
    const escrowInstance = await Escrow.deploy(productOwnership.address);

    await escrowInstance.deployed();

    escrow = escrowInstance;
  });

  it('#1 ìƒí’ˆ ìƒì„±í•˜ê¸°', async function () {
    const createProduct = await productOwnership
      .connect(user)
      .createProduct(...product);

    const receipt = await createProduct.wait();

    const events = receipt.events.filter((x) => {
      return x.event == 'NewProduct';
    });
    newProductEvents = events;

    expect(events).to.not.length(0);
  });

  it('#2 ì¶”ê°€ëœ ìƒí’ˆ ì¡°íšŒí•˜ê¸°', async function () {
    const lastEvent = newProductEvents.pop();
    const productId = lastEvent.args.id.toNumber();
    newProductId = productId;

    const [...hot] = await productOwnership.getProduct(productId);

    expect(hot).deep.to.equal(product);
  });

  it('#3 ìƒí’ˆ ìŠ¹ì¸í•˜ê¸°', async function () {
    await productOwnership.connect(user).approve(escrow.address, newProductId);

    const approved = await productOwnership.getApproved(newProductId);

    expect(approved).to.equal(escrow.address);
  });

  let newTradeId;

  it('#3 ìƒí’ˆ ì—ìŠ¤í¬ë¡œ ë“±ë¡í•˜ê¸°', async function () {
    const amount = ethers.utils.parseEther('1000'); // 1000 ETH
    const openTrade = await escrow
      .connect(user)
      .openTrade(newProductId, amount);

    const receipt = await openTrade.wait();
    const events = receipt.events.filter((x) => {
      return x.event == 'TradeStatusChange';
    });

    const { status, tradeId } = events[0].args;
    newTradeId = tradeId;

    expect(status).to.equal('open');

    const ownerOf = await productOwnership.ownerOf(newProductId);

    expect(ownerOf).to.equal(escrow.address);
  });

  it('#4 ì—ìŠ¤í¬ë¡œì— ë“±ë¡ëœ ìƒí’ˆí™•ì¸', async function () {
    const { poster, status } = await escrow.trades(newTradeId);

    const targetTrade = [poster, ethers.utils.parseBytes32String(status)];
    const expectTrade = [user.address, 'open'];

    expect(targetTrade).to.deep.equal(expectTrade);
  });

  it('#5 ì—ìŠ¤í¬ë¡œì— ë“±ë¡ëœ ìƒí’ˆ êµ¬ë§¤í•˜ê¸°', async function () {
    const amount = ethers.utils.parseEther('1000');

    const executeTrade = await escrow
      .connect(spender)
      .executeTrade(newTradeId, { value: amount });

    const receipt = await executeTrade.wait();
    const events = receipt.events.filter((x) => {
      return x.event == 'TradeStatusChange';
    });

    const { status } = events[0].args;

    expect(status).to.equal('executed');
  });

  it('#6 ì—ìŠ¤í¬ë¡œì— ë“±ë¡ëœ ìƒí’ˆ êµ¬ë§¤ í™•ì •í•˜ê¸°', async function () {
    const confirmTrade = await escrow.connect(user).confirmTrade(newTradeId);

    const receipt = await confirmTrade.wait();
    const events = receipt.events.filter((x) => {
      return x.event == 'TradeStatusChange';
    });

    const { status } = events[0].args;

    expect(status).to.equal('confirmed');

    const ownerOf = await productOwnership.ownerOf(newProductId);

    expect(ownerOf).to.equal(spender.address);
  });

  it('#7 êµ¬ë§¤ëœ ìƒí’ˆ ê±°ë˜ íŒŒê¸°í•˜ê¸°', async function () {
    const amount = ethers.utils.parseEther('1000'); // 1000 ETH
    const openTrade = await escrow
      .connect(spender)
      .openTrade(newProductId, amount);

    const receipt = await openTrade.wait();
    const events = receipt.events.filter((x) => {
      return x.event == 'TradeStatusChange';
    });

    const { tradeId } = events[0].args;

    await escrow.connect(user).executeTrade(tradeId, { value: amount });

    // ê±°ë˜íŒŒê¸°ëŠ” íŒë§¤ì ë˜ëŠ” ì»¨íŠ¸ë™íŠ¸ ì†Œìœ ìê°€ ìŠ¹ì¸
    await escrow.connect(spender).approveBreak(tradeId, user.address);

    // êµ¬ë§¤ì ì¸¡ì—ì„œ ê±°ë˜íŒŒê¸° ìš”ì²­
    await escrow.connect(user).breakTrade(tradeId);

    const trade = await escrow.trades(tradeId);
    const executedTrade = await escrow.executedTradeToSpender(tradeId);

    expect(trade.poster).to.equal(spender.address);
    expect(executedTrade).to.equal(
      '0x0000000000000000000000000000000000000000',
    );
  });

  it('#0 ProductOwnership ì»¨íŠ¸ë™íŠ¸ ë³€ê²½í•˜ê¸°', async function () {
    const Ownership = await ethers.getContractFactory('ProductOwnership');
    const ownershipInstance = await Ownership.deploy();

    await ownershipInstance.deployed();

    await escrow.setProductOwnership(ownershipInstance.address);

    const escrowProductAddress = await escrow.product();

    expect(escrowProductAddress).to.equal(ownershipInstance.address);
  });
});
```

# ìƒí’ˆ ì»¨íŠ¸ë™íŠ¸ ERC-721 í‘œì¤€í™”

---

[How to Write & Deploy an NFT (Part 1/3 of NFT Tutorial Series) | ethereum.org](https://ethereum.org/en/developers/tutorials/how-to-write-and-deploy-an-nft/)